"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.IconFontLayer = void 0;
const composite_layer_1 = require("../../core/composite-layer");
const constants_1 = require("../../core/constants");
const constants_2 = require("./constants");
const icon_1 = require("./icon");
class IconFontLayer extends icon_1.IconLayer {
    constructor() {
        super(...arguments);
        /**
         * 复合图层类型
         */
        this.type = composite_layer_1.CompositeLayer.LayerType.IconFontLayer;
        /**
         * 字体是否加载完成
         */
        this.fontLoaded = true;
    }
    /**
     * 添加到场景
     */
    addTo(scene) {
        this.scene = scene;
        this.initAssets();
        const callback = () => {
            this.subLayers.once(constants_1.LayerGroupEvent.INITED_LAYERS, () => {
                this.emit(constants_1.CompositeLayerEvent.INITED, this);
                this.emit(constants_1.CompositeLayerEvent.ADD, this);
            });
            this.subLayers.addTo(scene);
        };
        if (this.fontLoaded) {
            callback();
        }
        else {
            this.on('fontloaded', () => {
                callback();
            });
        }
    }
    /**
     * 初始化资源
     */
    initAssets() {
        this.loadIconFontAtlas();
    }
    /**
     * load 字体资源
     */
    loadIconFontAtlas() {
        const { fontFamily, fontPath, iconFonts } = this.options.iconAtlas;
        const scene = this.scene;
        if (fontFamily && fontPath) {
            this.fontLoaded = false;
            scene === null || scene === void 0 ? void 0 : scene.once('fontloaded', (e) => {
                this.emit('fontloaded', e);
                this.fontLoaded = true;
            });
            scene === null || scene === void 0 ? void 0 : scene.addFontFace(fontFamily, fontPath);
        }
        scene === null || scene === void 0 ? void 0 : scene.addIconFonts(iconFonts);
    }
}
exports.IconFontLayer = IconFontLayer;
/**
 * 默认配置项
 */
IconFontLayer.DefaultOptions = constants_2.DEFAULT_OPTIONS;
//# sourceMappingURL=icon-font.js.map