"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useControl = void 0;
var _l = require("@antv/l7");
var _ahooks = require("ahooks");
var _react = require("react");
var _useScene = require("../use-scene");
const useControl = (onCreate, onRemove, opts) => {
  const scene = (0, _useScene.useScene)();
  const controlRef = (0, _react.useRef)();
  (0, _react.useEffect)(() => {
    // @ts-ignore
    const custom = new _l.Control(opts);
    custom.onAdd = () => onCreate(scene);
    // eslint-disable-next-line @typescript-eslint/no-empty-function
    custom.onRemove = () => {};
    controlRef.current = custom;
    scene.addControl(custom);
    return () => {
      if (typeof onRemove === 'function') {
        onRemove(scene);
      }
      controlRef.current = null;
      scene.removeControl(custom);
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);
  (0, _ahooks.useUpdateEffect)(() => {
    controlRef.current?.setOptions(opts);
  }, [opts]);
};
exports.useControl = useControl;