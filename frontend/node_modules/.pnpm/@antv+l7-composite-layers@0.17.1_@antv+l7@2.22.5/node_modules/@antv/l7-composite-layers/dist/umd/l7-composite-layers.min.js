!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@antv/l7")):"function"==typeof define&&define.amd?define(["exports","@antv/l7"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).L7=e.L7||{},e.L7.CompositeLayers={}),e.L7)}(this,(function(e,t){"use strict";var r;e.CompositeLayerType=void 0,(r=e.CompositeLayerType||(e.CompositeLayerType={})).BubbleLayer="bubbleLayer",r.ChoroplethLayer="choroplethLayer",r.IconImageLayer="iconImageLayer",r.IconFontLayer="iconFontLayer",r.FlowLayer="flowLayer";var i=function(e){return null!==e&&"function"!=typeof e&&isFinite(e.length)},o={}.toString,n=function(e,t){return o.call(e)==="[object "+t+"]"},s=function(e){return n(e,"Function")},a=function(e){return Array.isArray?Array.isArray(e):n(e,"Array")},l=function(e){var t=typeof e;return null!==e&&"object"===t||"function"===t};function c(e,t){if(e)if(a(e))for(var r=0,i=e.length;r<i&&!1!==t(e[r],r);r++);else if(l(e))for(var o in e)if(e.hasOwnProperty(o)&&!1===t(e[o],o))break}var u,h=function(e){return"object"==typeof e&&null!==e},d=function(e){if(!h(e)||!n(e,"Object"))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},y=function(e){return n(e,"String")},f=Object.values?function(e){return Object.values(e)}:function(e){var t=[];return c(e,(function(r,i){s(e)&&"prototype"===i||t.push(r)})),t},p=function(e){return n(e,"Boolean")},g=function(e){return void 0===e},v=function(e){if("object"!=typeof e||null===e)return e;var t;if(a(e)){t=[];for(var r=0,i=e.length;r<i;r++)"object"==typeof e[r]&&null!=e[r]?t[r]=v(e[r]):t[r]=e[r]}else for(var o in t={},e)"object"==typeof e[o]&&null!=e[o]?t[o]=v(e[o]):t[o]=e[o];return t},m=function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(y(e)||y(t))return!1;if(i(e)||i(t)){if(e.length!==t.length)return!1;for(var r=!0,o=0;o<e.length&&(r=m(e[o],t[o]));o++);return r}if(h(e)||h(t)){var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(r=!0,o=0;o<n.length&&(r=m(e[n[o]],t[n[o]]));o++);return r}return!1},b=function(e,t,r){for(var i=0,o=y(t)?t.split("."):t;e&&i<o.length;)e=e[o[i++]];return void 0===e||i<o.length?r:e},L=function(e,t){return function(e,t,r){if(!a(e)&&!d(e))return e;var i=r;return c(e,(function(e,r){i=t(i,e,r)})),i}(e,(function(e,r,i){return t.includes(i)||(e[i]=r),e}),{})},S={},O=function(e){return S[e=e||"g"]?S[e]+=1:S[e]=1,e+S[e]};function w(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(r[i[o]]=e[i[o]])}return r}function k(e,t,r,i){return new(r||(r=Promise))((function(o,n){function s(e){try{l(i.next(e))}catch(e){n(e)}}function a(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError,function(e,t){if(!s(e))throw new TypeError("Expected a function");var r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var n=t?t.apply(this,i):i[0],s=r.cache;if(s.has(n))return s.get(n);var a=e.apply(this,i);return s.set(n,a),a};r.cache=new Map}((function(e,t){void 0===t&&(t={});var r=t.fontSize,i=t.fontFamily,o=t.fontWeight,n=t.fontStyle,s=t.fontVariant;return u||(u=document.createElement("canvas").getContext("2d")),u.font=[n,s,o,r+"px",i].join(" "),u.measureText(y(e)?e:"").width}),(function(e,t){return void 0===t&&(t={}),function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<r;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,o++)i[o]=n[s];return i}([e],f(t)).join("")}));var x=function(){function e(){this._events={}}return e.prototype.on=function(e,t,r){return this._events[e]||(this._events[e]=[]),this._events[e].push({callback:t,once:!!r}),this},e.prototype.once=function(e,t){return this.on(e,t,!0)},e.prototype.emit=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=this._events[e]||[],n=this._events["*"]||[],s=function(i){for(var o=i.length,n=0;n<o;n++)if(i[n]){var s=i[n],a=s.callback;s.once&&(i.splice(n,1),0===i.length&&delete t._events[e],o--,n--),a.apply(t,r)}};s(o),s(n)},e.prototype.off=function(e,t){if(e)if(t){for(var r=this._events[e]||[],i=r.length,o=0;o<i;o++)r[o].callback===t&&(r.splice(o,1),i--,o--);0===r.length&&delete this._events[e]}else delete this._events[e];else this._events={};return this},e.prototype.getEvents=function(){return this._events},e}();const I=["click","dblclick","unclick","undblclick","contextmenu","uncontextmenu","mouseenter","unmouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","unpick"],C=["show","hide","dataUpdate","destroy","legend","legend:color","legend:size",...I];var M,j,A;!function(e){e.CREATED="created",e.INITED="inited",e.ADD="add",e.REMOVE="remove"}(M||(M={})),function(e){e.CREATED="created",e.INITED="inited",e.ADD="add",e.REMOVE="remove"}(j||(j={})),function(e){e.INITED_LAYER="inited-layer",e.INITED_LAYERS="inited-layers"}(A||(A={}));class _ extends x{constructor(e=[],t={}){super(),this.layerMap=new Map,this.name=t.name?t.name:O("layerGroup");for(let t=0;t<e.length;t++){const r=e[t];this.addLayer(r)}}addTo(e){this.scene=e;let t=0;const r=this.layerMap.size;for(const i of this.layerMap.values())i.once("inited",(e=>{t++,this.emit(A.INITED_LAYER,e),t===r&&this.emit(A.INITED_LAYERS)})),i.addTo(e)}remove(){this.scene&&this.getLayers().forEach((e=>e.remove()))}hasLayer(e){const t="string"==typeof e?e:this.getLayerId(e);return this.layerMap.has(t)}addLayer(e){const t=this.getLayerId(e);this.layerMap.set(t,e),this.scene&&(e.once("inited",(e=>this.emit(A.INITED_LAYER,e))),e.addTo(this.scene))}addLayers(e){e.forEach((e=>{this.addLayer(e)}))}removeLayer(e){const t="string"==typeof e?e:this.getLayerId(e),r=this.layerMap.get(t);return!!r&&(this.layerMap.delete(t),this.scene&&r.remove(),!0)}getLayers(){return Array.from(this.layerMap.values())}getLayer(e){return this.layerMap.get(e)}getLayerByName(e){return this.getLayers().find((t=>t.name===e))}removeAllLayer(){for(const e of this.layerMap.values())this.scene&&e.remove();this.layerMap.clear()}isEmpty(){return 0===this.layerMap.size}setZIndex(e){for(const t of this.layerMap.values())t.setIndex(e)}getLayerId(e){return e.id}destroy(){this.remove(),this.off("*")}}function F(e,t){return(...r)=>{const i={};return e.forEach(((e,t)=>{i[e]=r[t]})),delete i[void 0],t(i)}}class D{static shape(e,t){if(y(t))e.shape(t);else if(s(t)){const r=[];e.shape(r.join("*"),F(r,t))}else if(l(t)){const r=t.field?t.field:"";if(s(t.value)){const i=a(r)?r:r.split("*");e.shape(r,F(i,t.value))}else e.shape(r,t.value);y(r)&&t.scale&&D.scale(e,r,t.scale)}}static size(e,t){if(n(t,"Number"))e.size(t);else if(a(t))e.size(t);else if(s(t)){const r=[];e.size(r.join("*"),F(r,t))}else if(l(t)){const r=t.field?t.field:"";if(s(t.value)){const i=a(r)?r:r.split("*");e.size(r,F(i,t.value))}else e.size(r,t.value);y(r)&&t.scale&&D.scale(e,r,t.scale)}}static color(e,t){if(y(t))e.color(t);else if(s(t)){const r=[];e.color(r.join("*"),F(r,t))}else if(l(t)){const r=t.field?t.field:"";if(s(t.value)){const i=a(r)?r:r.split("*");e.color(r,F(i,t.value))}else e.color(r,t.value);y(r)&&t.scale&&D.scale(e,r,t.scale)}}static scale(e,t,r){e.scale(t,r)}static rotate(e,t){y(t)||s(t)}static texture(e,t){y(t)&&e.texture(t)}static animate(e,t){(p(t)||l(t))&&e.animate(t)}static filter(e,t){const r=t.field?t.field:"",i=a(r)?r:r.split("*");e.filter(i.join("*"),F(i,t.value))}static style(e,t){t&&e.style(t)}static state(e,t){const{active:r,select:i}=t;r&&e.active(r),i&&e.select(i)}}const z={};window.addEventListener("keydown",(e=>{e.isComposing||229===e.keyCode||(z[e.key]=!0)})),window.addEventListener("keyup",(e=>{z[e.key]=!1}));function E(e,t,r=0,i=5){for(const o in t)if(Object.prototype.hasOwnProperty.call(t,o)){const n=t[o];null!==n&&d(n)?(d(e[o])||(e[o]={}),r<i?E(e[o],n,r+1,i):e[o]=t[o]):Array.isArray(n)?(e[o]=[],e[o]=e[o].concat(n)):void 0!==n&&(e[o]=n)}}const P=(e,r)=>{const{source:i}=e,o=w(e,["source"]),{source:n}=r,s=((e,...t)=>{for(let r=0;r<t.length;r+=1)E(e,t[r],0,1);return e})({},o,w(r,["source"]));return n instanceof t.Source?s.source=n:i instanceof t.Source?s.source=i:s.source=Object.assign(Object.assign({},i),n),s},Z=(e,r)=>{if(e instanceof t.Source&&r instanceof t.Source)return e!==r;const{data:i}=e,o=w(e,["data"]),{data:n}=r,s=w(r,["data"]);return i!==n||!m(o,s)};class T extends x{get inited(){return this.layer.inited}get source(){return this.layer.getSource()}constructor(e){super(),this.isComposite=!1;const{id:t,name:r,source:i,interaction:o=!1}=e;this.id=t||O("core-layer"),this.name=r||this.id,this.interaction=o,this.options=P(this.getDefaultOptions(),e),this.lastOptions=this.options,this.layer=this.createLayer(),this.adaptorLayerAttr(!1),this.setSource(i),this.emit(M.CREATED,this)}getDefaultOptions(){return T.DefaultOptions}getLayerConfig(){return L(this.options,["source","shape","color","size","scale","texture","style","animate","state"])}adaptorAttrOptions(e){return e}adaptorLayerAttr(e=!0){const t=["shape","color","size","scale","texture","filter","style","animate","state"],r=this.adaptorAttrOptions(this.options),i=this.adaptorAttrOptions(this.lastOptions);for(let o=0;o<t.length;o++){const n=t[o],s=r[n],a=i[n];g(s)||e&&m(s,a)||D[n](this.layer,s)}}setSource(e){if(e instanceof t.Source)this.layer.setSource(e);else{const{data:t}=e,r=w(e,["data"]);this.layer.getSource()?this.layer.setData(t,r):this.layer.source(t,r)}}getSource(){return this.source}addTo(e){this.scene=e,this.layer.once(M.INITED,(()=>{this.emit(M.INITED,this)})),this.layer.once(M.ADD,(()=>{this.emit(M.ADD,this)})),e.addLayer(this.layer)}remove(){this.scene&&(this.scene.removeLayer(this.layer),this.emit(M.REMOVE))}update(e,t=!0){var r,i;this.updateOption(e),this.updateConfig(e),t&&(null===(r=this.scene)||void 0===r||r.setEnableRender(!1)),(g(this.options.visible)||this.options.visible)&&this.adaptorLayerAttr(),e.source&&Z(e.source,this.lastOptions.source)&&this.changeData(e.source),t&&(null===(i=this.scene)||void 0===i||i.setEnableRender(!0),this.render())}updateOption(e){this.lastOptions=this.options,this.options=P(this.options,e)}updateConfig(e){g(e.zIndex)||m(this.lastOptions.zIndex,this.options.zIndex)||this.setIndex(e.zIndex),g(e.blend)||m(this.lastOptions.blend,this.options.blend)||this.setBlend(e.blend),g(e.minZoom)||m(this.lastOptions.minZoom,this.options.minZoom)||this.setMinZoom(e.minZoom),g(e.maxZoom)||m(this.lastOptions.maxZoom,this.options.maxZoom)||this.setMaxZoom(e.maxZoom),g(e.visible)||m(this.lastOptions.visible,this.options.visible)||(e.visible?this.show():this.hide())}render(){this.scene&&this.scene.render()}changeData(e){this.setSource(e)}setIndex(e){this.layer.setIndex(e)}setBlend(e){this.layer.setBlend(e)}setMinZoom(e){this.layer.setMinZoom(e)}setMaxZoom(e){this.layer.setMaxZoom(e)}show(){this.layer.inited&&this.layer.show()}hide(){this.layer.inited&&this.layer.hide()}toggleVisible(){this.isVisible()?this.hide():this.show()}isVisible(){return this.layer.inited?this.layer.isVisible():!!g(this.options.visible)||this.options.visible}boxSelect(e,t){this.layer.boxSelect(e,t)}fitBounds(e){this.layer.fitBounds(e)}getLegend(e){return this.layer.getLegend(e)}getLegendItems(e){return this.layer.getLegendItems(e)}on(e,t,r){return-1!==C.indexOf(e)?this.layer.on(e,t):super.on(e,t,r),this}once(e,t){return-1!==C.indexOf(e)?this.layer.once(e,t):super.once(e,t),this}off(e,t){return-1!==C.indexOf(e)?this.layer.off(e,t):super.off(e,t),this}destroy(){this.layer.destroy()}}T.DefaultOptions={};class H extends T{constructor(){super(...arguments),this.type="pointLayer"}createLayer(){const e=this.getLayerConfig();return new t.PointLayer(e)}}class N extends T{constructor(){super(...arguments),this.type="textLayer"}createLayer(){const e=this.getLayerConfig();return new t.PointLayer(e)}adaptorAttrOptions(e){const{field:t,style:r={}}=e,{fill:i,fontSize:o}=r||{},n={field:t,value:"text"};return Object.assign({shape:n,color:i,size:o},e)}}class W extends T{constructor(){super(...arguments),this.type="lineLayer"}createLayer(){const e=this.getLayerConfig();return new t.LineLayer(e)}}var B;e.LineStyleType=void 0,(B=e.LineStyleType||(e.LineStyleType={}))[B.solid=0]="solid",B[B.dash=1]="dash";class $ extends T{constructor(){super(...arguments),this.type="polygonLayer"}createLayer(){const e=this.getLayerConfig();return new t.PolygonLayer(e)}}class R extends x{constructor(e){super(),this.isComposite=!0;const{id:t,name:r}=e;this.id=t||O("composite-layer"),this.name=r||this.id,this.options=P(this.getDefaultOptions(),e),this.lastOptions=this.options,this.source=this.createSource();const i=this.createSubLayers();this.subLayers=new _(i),this.emit(j.CREATED,this)}getDefaultOptions(){return R.DefaultOptions}createSource(){const e=this.options.source,{data:r}=e,i=w(e,["data"]);return this.isSourceInstance(e)?e:new t.Source(r,i)}isSourceInstance(e){return e instanceof t.Source}setSubLayersSource(e){this.layer.changeData(e)}initSubLayersEvent(){}addTo(e){this.scene=e,this.subLayers.once(A.INITED_LAYERS,(()=>{this.emit(j.INITED,this),this.emit(j.ADD,this)})),this.subLayers.addTo(e)}remove(){this.scene&&(this.subLayers.remove(),this.emit(j.REMOVE))}update(e,t=!0){var r,i;this.updateOption(e),t&&(null===(r=this.scene)||void 0===r||r.setEnableRender(!1)),e.source&&Z(e.source,this.lastOptions.source)&&this.changeData(e.source),this.updateSubLayers(e),t&&(null===(i=this.scene)||void 0===i||i.setEnableRender(!0),this.render())}updateOption(e){this.lastOptions=this.options,this.options=P(this.options,e)}render(){this.scene&&this.scene.render()}changeData(e){this.setSubLayersSource(e)}setIndex(e){this.subLayers.setZIndex(e)}setBlend(e){this.layer.setBlend(e)}setMinZoom(e){this.subLayers.getLayers().forEach((t=>{t.setMinZoom(e)}))}setMaxZoom(e){this.subLayers.getLayers().forEach((t=>{t.setMaxZoom(e)}))}show(){this.layer.inited&&this.update({visible:!0})}hide(){this.layer.inited&&this.update({visible:!1})}toggleVisible(){this.isVisible()?this.hide():this.show()}isVisible(){return this.layer.inited?this.layer.isVisible():!!g(this.options.visible)||this.options.visible}boxSelect(e,t){this.layer.boxSelect(e,t)}fitBounds(e){this.layer.fitBounds(e)}getLegend(e){return this.layer.getLegend(e)}getLegendItems(e){return this.layer.getLegendItems(e)}getColorLegendItems(){const e=this.layer.getLegendItems("color");if(Array.isArray(e)&&0!==e.length){return e}return[]}getInteractionSubLayers(){return this.subLayers.getLayers().filter((e=>!0===e.interaction))}destroy(){this.subLayers.destroy()}on(e,t,r){return-1!==C.indexOf(e)?this.layer.on(e,t):super.on(e,t,r),this}once(e,t){return-1!==C.indexOf(e)?this.layer.once(e,t):super.once(e,t),this}off(e,t){return-1!==C.indexOf(e)?this.layer.off(e,t):super.off(e,t),this}}R.LayerType=e.CompositeLayerType,R.DefaultOptions={};const q={data:[],parser:{type:"json",x:"x",y:"y"}},V={data:{type:"FeatureCollection",features:[]},parser:{type:"geojson"}},U="#2f54eb",G={active:{fillColor:!1,strokeColor:U,lineWidth:1.5,lineOpacity:1},select:{fillColor:!1,strokeColor:U,lineWidth:1.5,lineOpacity:1}},Y={visible:!0,source:q,radius:12,fillColor:"#5FD3A6",lineWidth:1,state:{active:!1,select:!1},enabledMultiSelect:!1,triggerMultiSelectKey:"Shift"},K=e=>(g(e)||(!1===e.active?G.active=Object.assign(G.active,{fillColor:!1,strokeColor:!1}):"object"==typeof e.active&&(!1===e.active.fillColor?G.active.fillColor=!1:"string"==typeof e.active.fillColor&&(G.active.fillColor=e.active.fillColor),!1===e.active.strokeColor?G.active.strokeColor=!1:"string"==typeof e.active.strokeColor&&(G.active.strokeColor=e.active.strokeColor),"number"==typeof e.active.lineWidth&&(G.active.lineWidth=e.active.lineWidth),"number"==typeof e.active.lineOpacity&&(G.active.lineOpacity=e.active.lineOpacity)),!1===e.select?G.select=Object.assign(G.select,{fillColor:!1,strokeColor:!1}):"object"==typeof e.select&&(!1===e.select.fillColor?G.select.fillColor=!1:"string"==typeof e.select.fillColor&&(G.select.fillColor=e.select.fillColor),!1===e.select.strokeColor?G.select.strokeColor=!1:"string"==typeof e.select.strokeColor&&(G.select.strokeColor=e.select.strokeColor),"number"==typeof e.select.lineWidth&&(G.select.lineWidth=e.select.lineWidth),"number"==typeof e.select.lineOpacity&&(G.select.lineOpacity=e.select.lineOpacity))),G),J=e=>{const{visible:t,minZoom:r,maxZoom:i,zIndex:o=0,label:n,filter:s}=e,a=t&&Boolean(n)&&(g(null==n?void 0:n.visible)||(null==n?void 0:n.visible));return Object.assign(Object.assign({zIndex:o+.1,minZoom:r,maxZoom:i,filter:s},n),{visible:a})},Q=(e,t)=>e&&(!t||!!z[t]);class X extends R{get layer(){return this.fillLayer}get fillLayer(){return this.subLayers.getLayer("fillLayer")}get highlightStrokeLayer(){return this.subLayers.getLayer("highlightStrokeLayer")}get selectFillLayer(){return this.subLayers.getLayer("selectFillLayer")}get selectStrokeLayer(){return this.subLayers.getLayer("selectStrokeLayer")}get labelLayer(){return this.subLayers.getLayer("labelLayer")}constructor(e){super(e),this.type=R.LayerType.BubbleLayer,this.selectData=[],this.layerState=G,this.onHighlighHandle=e=>{const{feature:t,featureId:r}=e;this.setHighlightLayerSource(t,r)},this.onUnhighlighHandle=()=>{this.setHighlightLayerSource()},this.onSelectHandle=e=>{const{feature:t,featureId:r}=e;this.handleSelectData(r,t)},this.initSubLayersEvent()}getDefaultOptions(){return X.DefaultOptions}createSubLayers(){const e=this.source;this.layerState=K(this.options.state);return[new H(Object.assign(Object.assign({},this.getFillLayerOptions()),{id:"fillLayer",shape:"circle",source:e,interaction:!0})),new H(Object.assign(Object.assign({},this.getHighlightStrokeLayerOptions()),{id:"highlightStrokeLayer",shape:"circle"})),new H(Object.assign(Object.assign({},this.getSelectFillLayerOptions()),{id:"selectFillLayer",shape:"circle"})),new H(Object.assign(Object.assign({},this.getSelectStrokeLayerOptions()),{id:"selectStrokeLayer",shape:"circle"})),new N(Object.assign(Object.assign({},J(this.options)),{id:"labelLayer",source:e}))]}getFillLayerOptions(){const e=L(this.options,["source"]),{visible:t,minZoom:r,maxZoom:i,zIndex:o=0,fillColor:n,radius:s,opacity:a,strokeColor:l,lineOpacity:c,lineWidth:u}=e,h=w(e,["visible","minZoom","maxZoom","zIndex","fillColor","radius","opacity","strokeColor","lineOpacity","lineWidth"]),d=this.layerState,y={active:!1!==d.active.fillColor&&{color:d.active.fillColor},select:!1},f={opacity:a,stroke:l,strokeOpacity:g(c)?a:c,strokeWidth:u};return Object.assign(Object.assign({},h),{visible:t,minZoom:r,maxZoom:i,zIndex:o,color:n,size:s,state:y,style:f})}getHighlightStrokeLayerOptions(){var e;const{visible:t,minZoom:r,maxZoom:i,zIndex:o=0,radius:n}=this.options,s=this.layerState,a={opacity:0,stroke:s.active.strokeColor||void 0,strokeOpacity:s.active.lineOpacity,strokeWidth:null===(e=s.active)||void 0===e?void 0:e.lineWidth};return{visible:t&&Boolean(s.active.strokeColor),zIndex:o+.1,minZoom:r,maxZoom:i,source:q,size:n,style:a}}getSelectFillLayerOptions(){const{visible:e,minZoom:t,maxZoom:r,zIndex:i=0,radius:o,opacity:n}=this.options,s=this.layerState.select.fillColor||void 0,a={opacity:n};return{visible:e&&Boolean(s),zIndex:i+.1,minZoom:t,maxZoom:r,source:q,color:s,size:o,style:a,state:{select:!1,active:!1}}}getSelectStrokeLayerOptions(){const{visible:e,minZoom:t,maxZoom:r,zIndex:i=0,radius:o}=this.options,n=this.layerState,s={opacity:0,stroke:n.select.strokeColor||void 0,strokeOpacity:n.select.lineOpacity,strokeWidth:n.select.lineWidth};return{visible:e&&Boolean(s.stroke),zIndex:i+.1,minZoom:t,maxZoom:r,source:q,size:o,style:s}}setSubLayersSource(e){if(this.isSourceInstance(e))this.source=e,this.fillLayer.setSource(e),this.labelLayer.setSource(e);else{const{data:t}=e,r=w(e,["data"]);this.source.setData(t,r)}this.highlightStrokeLayer.changeData(q),this.selectFillLayer.changeData(q),this.selectStrokeLayer.changeData(q)}setHighlightLayerSource(e,t=-999){if(this.highlightData===t)return;const r=e?[e]:[],i=this.source.parser,o="geojson"===i.type?{type:"FeatureCollection",features:r}:r;if(r.length){const e=this.fillLayer.layer.getEncodedData().find((e=>e.id===t)),r=null==e?void 0:e.size;this.highlightStrokeLayer.update({size:r,source:{data:o,parser:i}})}else this.highlightStrokeLayer.changeData({data:o,parser:i});this.highlightData=t}setSelectLayerSource(e=[]){if(this.selectData.length===e.length&&m(this.selectData.map((({featureId:e})=>e)),e.map((({featureId:e})=>e))))return;const t=this.source.parser;if(e.length){const r="_Feature_Size_",i=this.fillLayer.layer.getEncodedData();let o;o="geojson"===t.type?{type:"FeatureCollection",features:e.map((({feature:e,featureId:t})=>{var o;return Object.assign(Object.assign({},e),{properties:Object.assign(Object.assign({},e.properties),{[r]:null===(o=i.find((e=>e.id===t)))||void 0===o?void 0:o.size})})}))}:e.map((({feature:e,featureId:t})=>{var o;return Object.assign(Object.assign({},e),{[r]:null===(o=i.find((e=>e.id===t)))||void 0===o?void 0:o.size})}));const n={field:r,value:e=>e[r]};this.selectFillLayer.update({size:n,source:{data:o,parser:t}}),this.selectStrokeLayer.update({size:n,source:{data:o,parser:t}})}else{const e="geojson"===t.type?{type:"FeatureCollection",features:[]}:[];this.selectFillLayer.changeData({data:e,parser:t}),this.selectStrokeLayer.changeData({data:e,parser:t})}this.selectData=e}initSubLayersEvent(){this.fillLayer.off("mousemove",this.onHighlighHandle),this.fillLayer.off("mouseout",this.onHighlighHandle),this.fillLayer.off("click",this.onSelectHandle),this.selectData=[],this.highlightData=null,this.options.state&&(this.options.state.active&&(this.fillLayer.on("mousemove",this.onHighlighHandle),this.fillLayer.on("mouseout",this.onUnhighlighHandle)),this.options.state.select&&this.fillLayer.on("click",this.onSelectHandle))}handleSelectData(e,t,r){const{enabledMultiSelect:i,triggerMultiSelectKey:o}=this.options,n=Q(i,o)||r;let s=v(this.selectData);const a=s.findIndex((t=>t.featureId===e));if(-1===a)n?s.push({feature:t,featureId:e}):s=[{feature:t,featureId:e}],this.emit("select",t,v(s));else{const e=s[a];n?s.splice(a,1):s=[],this.emit("unselect",e,v(s))}this.setSelectLayerSource(s)}update(e){super.update(e),this.initSubLayersEvent()}updateOption(e){super.updateOption(e),this.layerState=K(this.options.state)}updateSubLayers(e){this.fillLayer.update(this.getFillLayerOptions(),!1),this.highlightStrokeLayer.update(this.getHighlightStrokeLayerOptions(),!1),this.selectFillLayer.update(this.getSelectFillLayerOptions(),!1),this.selectStrokeLayer.update(this.getSelectStrokeLayerOptions(),!1),this.labelLayer.update(J(this.options),!1),this.options.visible&&(g(e.state)||m(this.lastOptions.state,this.options.state)||this.updateHighlightSubLayers(),this.layerState.active.strokeColor&&this.setHighlightLayerSource(),(this.layerState.select.fillColor||this.layerState.select.strokeColor)&&this.setSelectLayerSource())}updateHighlightSubLayers(){const e=this.layerState,t=K(this.lastOptions.state);t.active.strokeColor!==e.active.strokeColor&&(e.active.strokeColor?this.highlightStrokeLayer.show():this.highlightStrokeLayer.hide()),t.select.fillColor!==e.select.fillColor&&(e.select.fillColor?this.selectFillLayer.show():this.selectFillLayer.hide()),t.select.strokeColor!==e.select.strokeColor&&(e.select.strokeColor?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())}setIndex(e){this.fillLayer.setIndex(e),this.highlightStrokeLayer.setIndex(e+.1),this.selectFillLayer.setIndex(e+.1),this.selectStrokeLayer.setIndex(e+.1),this.labelLayer.setIndex(e+.1)}setActive(e,t){const r=this.fillLayer.source,i=r.getFeatureId(e,t);if(g(i))console.warn(`Feature non-existent by field: ${e},value: ${t}`);else if(this.layerState.active.fillColor&&this.fillLayer.layer.setActive(i),this.layerState.active.strokeColor){const e=r.getFeatureById(i);this.setHighlightLayerSource(e,i)}}setSelect(e,t){const r=this.fillLayer.source,i=r.getFeatureId(e,t);if(g(i))return void console.warn(`Feature non-existent by field: ${e},value: ${t}`);if(!1===this.layerState.select.strokeColor&&!1===this.layerState.select.fillColor)return;const o=r.getFeatureById(i),{enabledMultiSelect:n}=this.options;this.handleSelectData(i,o,n)}boxSelect(e,t){this.fillLayer.boxSelect(e,t)}}X.DefaultOptions=Y;const ee={active:{fillColor:!1,strokeColor:U,lineWidth:1,lineOpacity:1},select:{fillColor:!1,strokeColor:U,lineWidth:1,lineOpacity:1}},te={visible:!0,source:V,lineWidth:1,state:{active:!1,select:!1},enabledMultiSelect:!1,triggerMultiSelectKey:"Shift"},re=e=>(g(e)||(!1===e.active?ee.active=Object.assign(ee.active,{fill:!1,stroke:!1}):"object"==typeof e.active&&(!1===e.active.fillColor?ee.active.fillColor=!1:"string"==typeof e.active.fillColor&&(ee.active.fillColor=e.active.fillColor),!1===e.active.strokeColor?ee.active.strokeColor=!1:"string"==typeof e.active.strokeColor&&(ee.active.strokeColor=e.active.strokeColor),"number"==typeof e.active.lineWidth&&(ee.active.lineWidth=e.active.lineWidth),"number"==typeof e.active.lineOpacity&&(ee.active.lineOpacity=e.active.lineOpacity)),!1===e.select?ee.select=Object.assign(ee.select,{fill:!1,stroke:!1}):"object"==typeof e.select&&(!1===e.select.fillColor?ee.select.fillColor=!1:"string"==typeof e.select.fillColor&&(ee.select.fillColor=e.select.fillColor),!1===e.select.strokeColor?ee.select.strokeColor=!1:"string"==typeof e.select.strokeColor&&(ee.select.strokeColor=e.select.strokeColor),"number"==typeof e.select.lineWidth&&(ee.select.lineWidth=e.select.lineWidth),"number"==typeof e.select.lineOpacity&&(ee.select.lineOpacity=e.select.lineOpacity))),ee),ie=e=>!g(e)&&!p(e)&&(!g(e.coordinates)||!g(e.x)&&!g(e.y)||!g(e.geometry)),oe=(e,t)=>{const r=null==t?void 0:t.position;if(!ie(r))return e;const i=e.parser.type,o=e.transforms,n={data:e.originData,transforms:o};if(r.coordinates){const e=r.coordinates;n.parser={type:i,coordinates:e}}else if(r.x&&r.y){const e=r.x,t=r.y;n.parser={type:i,x:e,y:t}}else if(r.geometry){const e=r.geometry;n.parser={type:i,geometry:e}}return n},ne=(e,t)=>Object.assign(Object.assign({},J(e)),{source:oe(t,e.label)});class se extends R{get layer(){return this.fillLayer}get fillLayer(){return this.subLayers.getLayer("fillLayer")}get strokeLayer(){return this.subLayers.getLayer("strokeLayer")}get highlightStrokeLayer(){return this.subLayers.getLayer("highlightStrokeLayer")}get selectFillLayer(){return this.subLayers.getLayer("selectFillLayer")}get selectStrokeLayer(){return this.subLayers.getLayer("selectStrokeLayer")}get labelLayer(){return this.subLayers.getLayer("labelLayer")}constructor(e){super(e),this.type=R.LayerType.ChoroplethLayer,this.selectData=[],this.layerState=ee,this.onHighlighHandle=e=>{const{feature:t,featureId:r}=e;this.setHighlightLayerSource(t,r)},this.onUnhighlighHandle=()=>{this.setHighlightLayerSource()},this.onSelectHandle=e=>{const{feature:t,featureId:r}=e;this.handleSelectData(r,t)},this.initSubLayersEvent()}getDefaultOptions(){return se.DefaultOptions}createSubLayers(){const e=this.source;this.layerState=re(this.options.state);return[new $(Object.assign(Object.assign({},this.getFillLayerOptions()),{id:"fillLayer",shape:"fill",source:e,interaction:!0})),new W(Object.assign(Object.assign({},this.getStrokeLayerOptions()),{id:"strokeLayer",shape:"line",source:e})),new W(Object.assign(Object.assign({},this.getHighlightStrokeLayerOptions()),{id:"highlightStrokeLayer"})),new $(Object.assign(Object.assign({},this.getSelectFillLayerOptions()),{id:"selectFillLayer"})),new W(Object.assign(Object.assign({},this.getSelectStrokeLayerOptions()),{id:"selectStrokeLayer"})),new N(Object.assign(Object.assign({},ne(this.options,e)),{id:"labelLayer"}))]}getFillLayerOptions(){const e=L(this.options,["source"]),{visible:t,minZoom:r,maxZoom:i,zIndex:o=0,fillColor:n,opacity:s}=e,a=w(e,["visible","minZoom","maxZoom","zIndex","fillColor","opacity"]),l=this.layerState,c={active:!1!==l.active.fillColor&&{color:l.active.fillColor},select:!1},u={opacity:s};return Object.assign(Object.assign({},a),{visible:t,minZoom:r,maxZoom:i,zIndex:o,color:n,state:c,style:u})}getStrokeLayerOptions(){const{visible:e,minZoom:t,maxZoom:r,zIndex:i=0,opacity:o,strokeColor:n,lineWidth:s,lineOpacity:a,lineDash:l,lineType:c,filter:u}=this.options,h={opacity:g(a)?o:a,dashArray:l,lineType:c};return{visible:e&&Boolean(s)&&Boolean(n),zIndex:i,minZoom:t,maxZoom:r,size:s,color:n,style:h,filter:u}}getHighlightStrokeLayerOptions(){const{visible:e,minZoom:t,maxZoom:r,zIndex:i=0,lineWidth:o}=this.options,n=this.layerState,s=n.active.strokeColor||void 0,a=n.active.lineWidth||o;return{visible:e&&Boolean(s),zIndex:i+.1,minZoom:t,maxZoom:r,source:V,size:a,color:s,style:{opacity:n.active.lineOpacity}}}getSelectFillLayerOptions(){const{visible:e,minZoom:t,maxZoom:r,zIndex:i=0,opacity:o}=this.options,n=this.layerState.select.fillColor||void 0,s={opacity:o};return{visible:e&&Boolean(n),zIndex:i+.1,minZoom:t,maxZoom:r,source:V,color:n,style:s,state:{select:!1,active:!1}}}getSelectStrokeLayerOptions(){const{visible:e,minZoom:t,maxZoom:r,zIndex:i=0,lineWidth:o}=this.options,n=this.layerState,s=n.select.strokeColor||void 0,a=n.select.lineWidth||o;return{visible:e&&Boolean(s),zIndex:i+.1,minZoom:t,maxZoom:r,source:V,size:a,color:s,style:{opacity:n.select.lineOpacity}}}setSubLayersSource(e){var t;if(this.isSourceInstance(e))this.source=e,this.fillLayer.setSource(e),this.strokeLayer.setSource(e),this.labelLayer.setSource(e);else{const{data:r}=e,i=w(e,["data"]);if(this.source.setData(r,i),ie(null===(t=this.options.label)||void 0===t?void 0:t.position)){const e=oe(this.source,this.options.label);this.labelLayer.changeData(e)}}this.highlightStrokeLayer.changeData(V),this.selectFillLayer.changeData(V),this.selectStrokeLayer.changeData(V)}setHighlightLayerSource(e,t=-999){if(this.highlightData===t)return;const r=e?[e]:[],i=this.source.parser,o="geojson"===i.type?{type:"FeatureCollection",features:r}:r;this.highlightStrokeLayer.changeData({data:o,parser:i}),this.highlightData=t}setSelectLayerSource(e=[]){if(this.selectData.length===e.length&&m(this.selectData.map((({featureId:e})=>e)),e.map((({featureId:e})=>e))))return;const t=e.map((({feature:e})=>e)),r=this.source.parser,i="geojson"===r.type?{type:"FeatureCollection",features:t}:t;this.selectFillLayer.changeData({data:i,parser:r}),this.selectStrokeLayer.changeData({data:i,parser:r}),this.selectData=e}initSubLayersEvent(){this.fillLayer.off("mousemove",this.onHighlighHandle),this.fillLayer.off("mouseout",this.onHighlighHandle),this.fillLayer.off("click",this.onSelectHandle),this.selectData=[],this.highlightData=null,this.options.state&&(this.options.state.active&&(this.fillLayer.on("mousemove",this.onHighlighHandle),this.fillLayer.on("mouseout",this.onUnhighlighHandle)),this.options.state.select&&this.fillLayer.on("click",this.onSelectHandle))}handleSelectData(e,t,r){const{enabledMultiSelect:i,triggerMultiSelectKey:o}=this.options,n=Q(i,o)||r;let s=v(this.selectData);const a=s.findIndex((t=>t.featureId===e));if(-1===a)n?s.push({feature:t,featureId:e}):s=[{feature:t,featureId:e}],this.emit("select",t,v(s));else{const e=s[a];n?s.splice(a,1):s=[],this.emit("unselect",e,v(s))}this.setSelectLayerSource(s)}update(e){super.update(e),this.initSubLayersEvent()}updateOption(e){super.updateOption(e),this.layerState=re(this.options.state)}updateSubLayers(e){this.fillLayer.update(this.getFillLayerOptions(),!1),this.strokeLayer.update(this.getStrokeLayerOptions(),!1),this.highlightStrokeLayer.update(this.getHighlightStrokeLayerOptions(),!1),this.selectFillLayer.update(this.getSelectFillLayerOptions(),!1),this.selectStrokeLayer.update(this.getSelectStrokeLayerOptions(),!1),this.labelLayer.update(ne(this.options,this.source),!1),this.options.visible&&(g(e.state)||m(this.lastOptions.state,this.options.state)||this.updateHighlightSubLayers(),this.layerState.active.strokeColor&&this.setHighlightLayerSource(),(this.layerState.select.fillColor||this.layerState.select.strokeColor)&&this.setSelectLayerSource())}updateHighlightSubLayers(){const e=this.layerState,t=re(this.lastOptions.state);t.active.strokeColor!==e.active.strokeColor&&(e.active.strokeColor?this.highlightStrokeLayer.show():this.highlightStrokeLayer.hide()),t.select.fillColor!==e.select.fillColor&&(e.select.fillColor?this.selectFillLayer.show():this.selectFillLayer.hide()),t.select.strokeColor!==e.select.strokeColor&&(e.select.strokeColor?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())}setIndex(e){this.fillLayer.setIndex(e),this.strokeLayer.setIndex(e),this.highlightStrokeLayer.setIndex(e+.1),this.selectFillLayer.setIndex(e+.1),this.selectStrokeLayer.setIndex(e+.1),this.labelLayer.setIndex(e+.1)}setActive(e,t){const r=this.fillLayer.source,i=r.getFeatureId(e,t);if(g(i))console.warn(`Feature non-existent by field: ${e},value: ${t}`);else if(this.layerState.active.fillColor&&this.fillLayer.layer.setActive(i),this.layerState.active.strokeColor){const e=r.getFeatureById(i);this.setHighlightLayerSource(e,i)}}setSelect(e,t){const r=this.fillLayer.source,i=r.getFeatureId(e,t);if(g(i))return void console.warn(`Feature non-existent by field: ${e},value: ${t}`);if(!1===this.layerState.select.strokeColor&&!1===this.layerState.select.fillColor)return;const o=r.getFeatureById(i),{enabledMultiSelect:n}=this.options;this.handleSelectData(i,o,n)}boxSelect(e,t){this.fillLayer.boxSelect(e,t)}}se.DefaultOptions=te;const ae={active:{enable:!1,color:U},select:{enable:!1,radius:10,opacity:1}},le={visible:!0,source:q,radius:12,icon:{value:"1"},state:{active:!1,select:!1},blend:"normal",enabledMultiSelect:!1,triggerMultiSelectKey:"Shift"},ce=e=>Object.assign(Object.assign({},ae),e);class ue extends R{get layer(){return this.iconLayer}get iconLayer(){return this.subLayers.getLayer("iconLayer")}get iconLabelLayer(){return this.subLayers.getLayer("labelLayer")}get selectIconLayer(){return this.subLayers.getLayer("selectIconLayer")}constructor(e){super(e),this.layerState=ae,this.type=R.LayerType.IconImageLayer,this.selectData=[],this.onSelectHandle=e=>{const{feature:t,featureId:r}=e;this.handleSelectData(r,t)},this.initSubLayersEvent()}getDefaultOptions(){return ue.DefaultOptions}addTo(e){this.scene=e,this.initAssets(),this.subLayers.addTo(e),this.emit(j.ADD)}getIconLayerOptions(){var e;const t=L(this.options,["source"]),{visible:r,minZoom:i,maxZoom:o,zIndex:n=0,radius:s,opacity:a,icon:l,fillColor:c,iconStyle:u}=t,h=w(t,["visible","minZoom","maxZoom","zIndex","radius","opacity","icon","fillColor","iconStyle"]),d={active:null===(e=this.options.state)||void 0===e?void 0:e.active,select:!1},y=Object.assign({opacity:a},u);return Object.assign(Object.assign({},h),{visible:r,minZoom:i,maxZoom:o,zIndex:n,shape:l,size:s,state:d,color:c,style:y})}getHighLightLayerOptions(){var e;const{visible:r,minZoom:i,maxZoom:o,zIndex:n=0,icon:s}=this.options,a=null===(e=this.layerState)||void 0===e?void 0:e.select,{radius:l=5,opacity:c=1}=a,u={opacity:c};return{visible:r,blend:t.BlendType.normal,zIndex:n+.1,minZoom:i,maxZoom:o,source:q,size:l,style:u,shape:(null==a?void 0:a.icon)||s,state:{select:!1,active:!1}}}handleSelectData(e,t,r){const{enabledMultiSelect:i,triggerMultiSelectKey:o}=this.options,n=Q(i,o)||r;let s=v(this.selectData);const a=s.findIndex((t=>t.featureId===e));if(-1===a)n?s.push({feature:t,featureId:e}):s=[{feature:t,featureId:e}],this.emit("select",t,v(s));else{const e=s[a];n?s.splice(a,1):s=[],this.emit("unselect",e,v(s))}this.setSelectLayerSource(s)}createSubLayers(){const e=this.source;this.layerState=ce(this.options.state);const t=new H(Object.assign(Object.assign({},this.getIconLayerOptions()),{id:"iconLayer",source:e,interaction:!0})),r=new H(Object.assign({id:"selectIconLayer"},this.getHighLightLayerOptions()));return[t,new N(Object.assign(Object.assign({},J(this.options)),{id:"labelLayer",source:e})),r]}updateSubLayers(e){this.iconLayer.update(this.getIconLayerOptions(),!1),this.iconLabelLayer.update(J(this.options),!1)}setSelectLayerSource(e=[]){if(this.selectData.length===e.length&&m(this.selectData.map((({featureId:e})=>e)),e.map((({featureId:e})=>e))))return;const t=e.map((({feature:e})=>e)),r=this.source.parser,i="geojson"===r.type?{type:"FeatureCollection",features:t}:t;this.selectIconLayer.changeData({data:i,parser:r}),this.selectData=e}setSubLayersSource(e){if(this.isSourceInstance(e))this.source=e,this.iconLayer.setSource(e),this.iconLabelLayer.setSource(e);else{const{data:t}=e,r=w(e,["data"]);this.source.setData(t,r)}this.selectIconLayer.changeData(q)}initSubLayersEvent(){this.iconLayer.off("click",this.onSelectHandle),this.selectData=[],this.options.state&&this.options.state.select&&this.iconLayer.on("click",this.onSelectHandle)}updateOption(e){super.updateOption(e),this.layerState=ce(this.options.state)}setIndex(e){this.iconLayer.setIndex(e),this.iconLabelLayer.setIndex(e),this.selectIconLayer.setIndex(e+.1)}setActive(e,t){const r=this.iconLayer.source.getFeatureId(e,t);g(r)?console.warn(`Feature non-existent by field: ${e},value: ${t}`):this.iconLayer.layer.setActive(r)}update(e){super.update(e),this.initSubLayersEvent()}setSelect(e,t){var r,i;const o=this.iconLayer.source,n=o.getFeatureId(e,t);if(g(n))return void console.warn(`Feature non-existent by field: ${e},value: ${t}`);if((null===(r=this.layerState)||void 0===r?void 0:r.select)&&!1!==(null===(i=this.layerState)||void 0===i?void 0:i.select).enable)return;const s=o.getFeatureById(n),{enabledMultiSelect:a}=this.options;this.handleSelectData(n,s,a)}boxSelect(e,t){this.iconLayer.boxSelect(e,t)}}ue.DefaultOptions=le;class he extends ue{constructor(){super(...arguments),this.type=R.LayerType.IconFontLayer,this.fontLoaded=!0}addTo(e){this.scene=e,this.initAssets();const t=()=>{this.subLayers.once(A.INITED_LAYERS,(()=>{this.emit(j.INITED,this),this.emit(j.ADD,this)})),this.subLayers.addTo(e)};this.fontLoaded?t():this.on("fontloaded",(()=>{t()}))}initAssets(){this.loadIconFontAtlas()}loadIconFontAtlas(){const{fontFamily:e,fontPath:t,iconFonts:r}=this.options.iconAtlas,i=this.scene;e&&t&&(this.fontLoaded=!1,null==i||i.once("fontloaded",(e=>{this.emit("fontloaded",e),this.fontLoaded=!0})),null==i||i.addFontFace(e,t)),null==i||i.addIconFonts(r)}}he.DefaultOptions=le;var de="object"==typeof global&&global&&global.Object===Object&&global,ye="object"==typeof self&&self&&self.Object===Object&&self,fe=de||ye||Function("return this")(),pe=fe.Symbol,ge=Object.prototype,ve=ge.hasOwnProperty,me=ge.toString,be=pe?pe.toStringTag:void 0;var Le=Object.prototype.toString;var Se="[object Null]",Oe="[object Undefined]",we=pe?pe.toStringTag:void 0;function ke(e){return null==e?void 0===e?Oe:Se:we&&we in Object(e)?function(e){var t=ve.call(e,be),r=e[be];try{e[be]=void 0;var i=!0}catch(e){}var o=me.call(e);return i&&(t?e[be]=r:delete e[be]),o}(e):function(e){return Le.call(e)}(e)}function xe(e){return null!=e&&"object"==typeof e}var Ie="[object Symbol]";var Ce=Array.isArray,Me=/\s/;var je=/^\s+/;function Ae(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&Me.test(e.charAt(t)););return t}(e)+1).replace(je,""):e}function _e(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var Fe=NaN,De=/^[-+]0x[0-9a-f]+$/i,ze=/^0b[01]+$/i,Ee=/^0o[0-7]+$/i,Pe=parseInt;function Ze(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||xe(e)&&ke(e)==Ie}(e))return Fe;if(_e(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_e(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ae(e);var r=ze.test(e);return r||Ee.test(e)?Pe(e.slice(2),r?2:8):De.test(e)?Fe:+e}var Te="[object AsyncFunction]",He="[object Function]",Ne="[object GeneratorFunction]",We="[object Proxy]";function Be(e){if(!_e(e))return!1;var t=ke(e);return t==He||t==Ne||t==Te||t==We}var $e,Re=fe["__core-js_shared__"],qe=($e=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+$e:"";var Ve=Function.prototype.toString;function Ue(e){if(null!=e){try{return Ve.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var Ge=/^\[object .+?Constructor\]$/,Ye=Function.prototype,Ke=Object.prototype,Je=Ye.toString,Qe=Ke.hasOwnProperty,Xe=RegExp("^"+Je.call(Qe).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function et(e){return!(!_e(e)||(t=e,qe&&qe in t))&&(Be(e)?Xe:Ge).test(Ue(e));var t}function tt(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return et(r)?r:void 0}var rt=tt(fe,"WeakMap"),it=9007199254740991,ot=/^(?:0|[1-9]\d*)$/;function nt(e,t){var r=typeof e;return!!(t=null==t?it:t)&&("number"==r||"symbol"!=r&&ot.test(e))&&e>-1&&e%1==0&&e<t}function st(e,t){return e===t||e!=e&&t!=t}var at=9007199254740991;function lt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=at}var ct=Object.prototype;function ut(e){return xe(e)&&"[object Arguments]"==ke(e)}var ht=Object.prototype,dt=ht.hasOwnProperty,yt=ht.propertyIsEnumerable,ft=ut(function(){return arguments}())?ut:function(e){return xe(e)&&dt.call(e,"callee")&&!yt.call(e,"callee")},pt=ft;var gt="object"==typeof e&&e&&!e.nodeType&&e,vt=gt&&"object"==typeof module&&module&&!module.nodeType&&module,mt=vt&&vt.exports===gt?fe.Buffer:void 0,bt=(mt?mt.isBuffer:void 0)||function(){return!1},Lt={};Lt["[object Float32Array]"]=Lt["[object Float64Array]"]=Lt["[object Int8Array]"]=Lt["[object Int16Array]"]=Lt["[object Int32Array]"]=Lt["[object Uint8Array]"]=Lt["[object Uint8ClampedArray]"]=Lt["[object Uint16Array]"]=Lt["[object Uint32Array]"]=!0,Lt["[object Arguments]"]=Lt["[object Array]"]=Lt["[object ArrayBuffer]"]=Lt["[object Boolean]"]=Lt["[object DataView]"]=Lt["[object Date]"]=Lt["[object Error]"]=Lt["[object Function]"]=Lt["[object Map]"]=Lt["[object Number]"]=Lt["[object Object]"]=Lt["[object RegExp]"]=Lt["[object Set]"]=Lt["[object String]"]=Lt["[object WeakMap]"]=!1;var St,Ot="object"==typeof e&&e&&!e.nodeType&&e,wt=Ot&&"object"==typeof module&&module&&!module.nodeType&&module,kt=wt&&wt.exports===Ot&&de.process,xt=function(){try{var e=wt&&wt.require&&wt.require("util").types;return e||kt&&kt.binding&&kt.binding("util")}catch(e){}}(),It=xt&&xt.isTypedArray,Ct=It?(St=It,function(e){return St(e)}):function(e){return xe(e)&&lt(e.length)&&!!Lt[ke(e)]},Mt=Object.prototype.hasOwnProperty;function jt(e,t){var r=Ce(e),i=!r&&pt(e),o=!r&&!i&&bt(e),n=!r&&!i&&!o&&Ct(e),s=r||i||o||n,a=s?function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}(e.length,String):[],l=a.length;for(var c in e)!t&&!Mt.call(e,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||n&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||nt(c,l))||a.push(c);return a}var At=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),_t=At,Ft=Object.prototype.hasOwnProperty;function Dt(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||ct))return _t(e);var t,r,i=[];for(var o in Object(e))Ft.call(e,o)&&"constructor"!=o&&i.push(o);return i}function zt(e){return null!=(t=e)&&lt(t.length)&&!Be(t)?jt(e):Dt(e);var t}var Et=tt(Object,"create");var Pt=Object.prototype.hasOwnProperty;var Zt=Object.prototype.hasOwnProperty;function Tt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function Ht(e,t){for(var r=e.length;r--;)if(st(e[r][0],t))return r;return-1}Tt.prototype.clear=function(){this.__data__=Et?Et(null):{},this.size=0},Tt.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Tt.prototype.get=function(e){var t=this.__data__;if(Et){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Pt.call(t,e)?t[e]:void 0},Tt.prototype.has=function(e){var t=this.__data__;return Et?void 0!==t[e]:Zt.call(t,e)},Tt.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Et&&void 0===t?"__lodash_hash_undefined__":t,this};var Nt=Array.prototype.splice;function Wt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}Wt.prototype.clear=function(){this.__data__=[],this.size=0},Wt.prototype.delete=function(e){var t=this.__data__,r=Ht(t,e);return!(r<0)&&(r==t.length-1?t.pop():Nt.call(t,r,1),--this.size,!0)},Wt.prototype.get=function(e){var t=this.__data__,r=Ht(t,e);return r<0?void 0:t[r][1]},Wt.prototype.has=function(e){return Ht(this.__data__,e)>-1},Wt.prototype.set=function(e,t){var r=this.__data__,i=Ht(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this};var Bt=tt(fe,"Map");function $t(e,t){var r,i,o=e.__data__;return("string"==(i=typeof(r=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function Rt(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}Rt.prototype.clear=function(){this.size=0,this.__data__={hash:new Tt,map:new(Bt||Wt),string:new Tt}},Rt.prototype.delete=function(e){var t=$t(this,e).delete(e);return this.size-=t?1:0,t},Rt.prototype.get=function(e){return $t(this,e).get(e)},Rt.prototype.has=function(e){return $t(this,e).has(e)},Rt.prototype.set=function(e,t){var r=$t(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this};function qt(e){var t=this.__data__=new Wt(e);this.size=t.size}qt.prototype.clear=function(){this.__data__=new Wt,this.size=0},qt.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},qt.prototype.get=function(e){return this.__data__.get(e)},qt.prototype.has=function(e){return this.__data__.has(e)},qt.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Wt){var i=r.__data__;if(!Bt||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new Rt(i)}return r.set(e,t),this.size=r.size,this};var Vt=Object.prototype.propertyIsEnumerable,Ut=Object.getOwnPropertySymbols,Gt=Ut?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,i=null==e?0:e.length,o=0,n=[];++r<i;){var s=e[r];t(s,r,e)&&(n[o++]=s)}return n}(Ut(e),(function(t){return Vt.call(e,t)})))}:function(){return[]};function Yt(e){return function(e,t,r){var i=t(e);return Ce(e)?i:function(e,t){for(var r=-1,i=t.length,o=e.length;++r<i;)e[o+r]=t[r];return e}(i,r(e))}(e,zt,Gt)}var Kt=tt(fe,"DataView"),Jt=tt(fe,"Promise"),Qt=tt(fe,"Set"),Xt="[object Map]",er="[object Promise]",tr="[object Set]",rr="[object WeakMap]",ir="[object DataView]",or=Ue(Kt),nr=Ue(Bt),sr=Ue(Jt),ar=Ue(Qt),lr=Ue(rt),cr=ke;(Kt&&cr(new Kt(new ArrayBuffer(1)))!=ir||Bt&&cr(new Bt)!=Xt||Jt&&cr(Jt.resolve())!=er||Qt&&cr(new Qt)!=tr||rt&&cr(new rt)!=rr)&&(cr=function(e){var t=ke(e),r="[object Object]"==t?e.constructor:void 0,i=r?Ue(r):"";if(i)switch(i){case or:return ir;case nr:return Xt;case sr:return er;case ar:return tr;case lr:return rr}return t});var ur=cr,hr=fe.Uint8Array;function dr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Rt;++t<r;)this.add(e[t])}function yr(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}dr.prototype.add=dr.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},dr.prototype.has=function(e){return this.__data__.has(e)};var fr=1,pr=2;function gr(e,t,r,i,o,n){var s=r&fr,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=n.get(e),u=n.get(t);if(c&&u)return c==t&&u==e;var h=-1,d=!0,y=r&pr?new dr:void 0;for(n.set(e,t),n.set(t,e);++h<a;){var f=e[h],p=t[h];if(i)var g=s?i(p,f,h,t,e,n):i(f,p,h,e,t,n);if(void 0!==g){if(g)continue;d=!1;break}if(y){if(!yr(t,(function(e,t){if(s=t,!y.has(s)&&(f===e||o(f,e,r,i,n)))return y.push(t);var s}))){d=!1;break}}else if(f!==p&&!o(f,p,r,i,n)){d=!1;break}}return n.delete(e),n.delete(t),d}function vr(e){var t=-1,r=Array(e.size);return e.forEach((function(e,i){r[++t]=[i,e]})),r}function mr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var br=1,Lr=2,Sr="[object Boolean]",Or="[object Date]",wr="[object Error]",kr="[object Map]",xr="[object Number]",Ir="[object RegExp]",Cr="[object Set]",Mr="[object String]",jr="[object Symbol]",Ar="[object ArrayBuffer]",_r="[object DataView]",Fr=pe?pe.prototype:void 0,Dr=Fr?Fr.valueOf:void 0;var zr=1,Er=Object.prototype.hasOwnProperty;var Pr=1,Zr="[object Arguments]",Tr="[object Array]",Hr="[object Object]",Nr=Object.prototype.hasOwnProperty;function Wr(e,t,r,i,o,n){var s=Ce(e),a=Ce(t),l=s?Tr:ur(e),c=a?Tr:ur(t),u=(l=l==Zr?Hr:l)==Hr,h=(c=c==Zr?Hr:c)==Hr,d=l==c;if(d&&bt(e)){if(!bt(t))return!1;s=!0,u=!1}if(d&&!u)return n||(n=new qt),s||Ct(e)?gr(e,t,r,i,o,n):function(e,t,r,i,o,n,s){switch(r){case _r:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ar:return!(e.byteLength!=t.byteLength||!n(new hr(e),new hr(t)));case Sr:case Or:case xr:return st(+e,+t);case wr:return e.name==t.name&&e.message==t.message;case Ir:case Mr:return e==t+"";case kr:var a=vr;case Cr:var l=i&br;if(a||(a=mr),e.size!=t.size&&!l)return!1;var c=s.get(e);if(c)return c==t;i|=Lr,s.set(e,t);var u=gr(a(e),a(t),i,o,n,s);return s.delete(e),u;case jr:if(Dr)return Dr.call(e)==Dr.call(t)}return!1}(e,t,l,r,i,o,n);if(!(r&Pr)){var y=u&&Nr.call(e,"__wrapped__"),f=h&&Nr.call(t,"__wrapped__");if(y||f){var p=y?e.value():e,g=f?t.value():t;return n||(n=new qt),o(p,g,r,i,n)}}return!!d&&(n||(n=new qt),function(e,t,r,i,o,n){var s=r&zr,a=Yt(e),l=a.length;if(l!=Yt(t).length&&!s)return!1;for(var c=l;c--;){var u=a[c];if(!(s?u in t:Er.call(t,u)))return!1}var h=n.get(e),d=n.get(t);if(h&&d)return h==t&&d==e;var y=!0;n.set(e,t),n.set(t,e);for(var f=s;++c<l;){var p=e[u=a[c]],g=t[u];if(i)var v=s?i(g,p,u,t,e,n):i(p,g,u,e,t,n);if(!(void 0===v?p===g||o(p,g,r,i,n):v)){y=!1;break}f||(f="constructor"==u)}if(y&&!f){var m=e.constructor,b=t.constructor;m==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof m&&m instanceof m&&"function"==typeof b&&b instanceof b||(y=!1)}return n.delete(e),n.delete(t),y}(e,t,r,i,o,n))}function Br(e,t,r,i,o){return e===t||(null==e||null==t||!xe(e)&&!xe(t)?e!=e&&t!=t:Wr(e,t,r,i,Br,o))}var $r=function(){return fe.Date.now()},Rr=Math.max,qr=Math.min;function Vr(e,t,r){var i,o,n,s,a,l,c=0,u=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var r=i,n=o;return i=o=void 0,c=t,s=e.apply(n,r)}function f(e){var r=e-l;return void 0===l||r>=t||r<0||h&&e-c>=n}function p(){var e=$r();if(f(e))return g(e);a=setTimeout(p,function(e){var r=t-(e-l);return h?qr(r,n-(e-c)):r}(e))}function g(e){return a=void 0,d&&i?y(e):(i=o=void 0,s)}function v(){var e=$r(),r=f(e);if(i=arguments,o=this,l=e,r){if(void 0===a)return function(e){return c=e,a=setTimeout(p,t),u?y(e):s}(l);if(h)return clearTimeout(a),a=setTimeout(p,t),y(l)}return void 0===a&&(a=setTimeout(p,t)),s}return t=Ze(t)||0,_e(r)&&(u=!!r.leading,n=(h="maxWait"in r)?Rr(Ze(r.maxWait)||0,t):n,d="trailing"in r?!!r.trailing:d),v.cancel=function(){void 0!==a&&clearTimeout(a),c=0,i=l=o=a=void 0},v.flush=function(){return void 0===a?s:g($r())},v}class Ur extends ue{constructor(){super(...arguments),this.type=R.LayerType.IconImageLayer}addTo(e){this.scene=e,this.initAssets().then((()=>{this.subLayers.once(A.INITED_LAYERS,(()=>{this.emit(j.INITED,this),this.emit(j.ADD,this)})),this.subLayers.addTo(e)}))}initAssets(){return k(this,void 0,void 0,(function*(){yield this.loadIconAtlas()}))}updateAssets(){return k(this,void 0,void 0,(function*(){yield this.loadIconAtlas()}))}updateSubLayers(e){var t,r;e.iconAtlas&&(t=e.iconAtlas,r=this.lastOptions.iconAtlas,!Br(t,r))?this.updateAssets().then((()=>{super.updateSubLayers(e)})):super.updateSubLayers(e)}loadIconAtlas(){return k(this,void 0,void 0,(function*(){const e=this.options.iconAtlas,t=this.scene;if(!t)return;const r=Object.entries(e).filter((([e])=>!1===t.hasImage(e)));yield Promise.all(r.map((e=>k(this,[e],void 0,(function*([e,r]){return yield t.addImage(e,r)})))))}))}}Ur.DefaultOptions=le;var Gr=6371008.8,Yr={centimeters:100*Gr,centimetres:100*Gr,degrees:Gr/111325,feet:3.28084*Gr,inches:39.37*Gr,kilometers:Gr/1e3,kilometres:Gr/1e3,meters:Gr,metres:Gr,miles:Gr/1609.344,millimeters:1e3*Gr,millimetres:1e3*Gr,nauticalmiles:Gr/1852,radians:1,yards:1.0936*Gr};function Kr(e,t,r){void 0===r&&(r={});var i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function Jr(e,t,r){if(void 0===r&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ei(e[0])||!ei(e[1]))throw new Error("coordinates must contain numbers");return Kr({type:"Point",coordinates:e},t,r)}function Qr(e){return e%360*Math.PI/180}function Xr(e,t,r){if(void 0===t&&(t="kilometers"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return function(e,t){void 0===t&&(t="kilometers");var r=Yr[t];if(!r)throw new Error(t+" units is invalid");return e*r}(function(e,t){void 0===t&&(t="kilometers");var r=Yr[t];if(!r)throw new Error(t+" units is invalid");return e/r}(e,t),r)}function ei(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function ti(e,t,r){if(null!==e)for(var i,o,n,s,a,l,c,u,h=0,d=0,y=e.type,f="FeatureCollection"===y,p="Feature"===y,g=f?e.features.length:1,v=0;v<g;v++){a=(u=!!(c=f?e.features[v].geometry:p?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var m=0;m<a;m++){var b=0,L=0;if(null!==(s=u?c.geometries[m]:c)){l=s.coordinates;var S=s.type;switch(h=!r||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===t(l,d,v,b,L))return!1;d++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(!1===t(l[i],d,v,b,L))return!1;d++,"MultiPoint"===S&&b++}"LineString"===S&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(o=0;o<l[i].length-h;o++){if(!1===t(l[i][o],d,v,b,L))return!1;d++}"MultiLineString"===S&&b++,"Polygon"===S&&L++}"Polygon"===S&&b++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for(L=0,o=0;o<l[i].length;o++){for(n=0;n<l[i][o].length-h;n++){if(!1===t(l[i][o][n],d,v,b,L))return!1;d++}L++}b++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===ti(s.geometries[i],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ri(e){var t=[1/0,1/0,-1/0,-1/0];return ti(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}function ii(e,t){void 0===t&&(t={});var r=Number(e[0]),i=Number(e[1]),o=Number(e[2]),n=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[r,i];return function(e,t,r){void 0===r&&(r={});for(var i=0,o=e;i<o.length;i++){var n=o[i];if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<n[n.length-1].length;s++)if(n[n.length-1][s]!==n[0][s])throw new Error("First and last Position are not equivalent.")}return Kr({type:"Polygon",coordinates:e},t,r)}([[s,[o,i],[o,n],[r,n],s]],t.properties,{bbox:e,id:t.id})}function oi(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return ni(e);case"FeatureCollection":return function(e){var t={type:"FeatureCollection"};return Object.keys(e).forEach((function(r){switch(r){case"type":case"features":return;default:t[r]=e[r]}})),t.features=e.features.map((function(e){return ni(e)})),t}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return ai(e);default:throw new Error("unknown GeoJSON type")}}function ni(e){var t={type:"Feature"};return Object.keys(e).forEach((function(r){switch(r){case"type":case"properties":case"geometry":return;default:t[r]=e[r]}})),t.properties=si(e.properties),t.geometry=ai(e.geometry),t}function si(e){var t={};return e?(Object.keys(e).forEach((function(r){var i=e[r];"object"==typeof i?null===i?t[r]=null:Array.isArray(i)?t[r]=i.map((function(e){return e})):t[r]=si(i):t[r]=i})),t):t}function ai(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map((function(e){return ai(e)})),t):(t.coordinates=li(e.coordinates),t)}function li(e){var t=e;return"object"!=typeof t[0]?t.slice():t.map((function(e){return li(e)}))}function ci(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ui(e,t){var r=Qr(e[1]),i=Qr(t[1]),o=Qr(t[0]-e[0]);o>Math.PI&&(o-=2*Math.PI),o<-Math.PI&&(o+=2*Math.PI);var n=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),s=Math.atan2(o,n);return(s%(2*Math.PI)*180/Math.PI+360)%360}function hi(e,t,r){void 0===r&&(r={});var i=ci(e),o=ci(t);o[0]+=o[0]-i[0]>180?-360:i[0]-o[0]>180?360:0;var n=function(e,t,r){var i=r=void 0===r?Gr:Number(r),o=e[1]*Math.PI/180,n=t[1]*Math.PI/180,s=n-o,a=Math.abs(t[0]-e[0])*Math.PI/180;a>Math.PI&&(a-=2*Math.PI);var l=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),c=Math.abs(l)>1e-11?s/l:Math.cos(o);return Math.sqrt(s*s+c*c*a*a)*i}(i,o);return Xr(n,"meters",r.units)}function di(e,t,r,i){void 0===i&&(i={});var o=t<0,n=Xr(Math.abs(t),i.units,"meters");o&&(n=-Math.abs(n));var s=ci(e),a=function(e,t,r,i){i=void 0===i?Gr:Number(i);var o=t/i,n=e[0]*Math.PI/180,s=Qr(e[1]),a=Qr(r),l=o*Math.cos(a),c=s+l;Math.abs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c);var u=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),h=Math.abs(u)>1e-11?l/u:Math.cos(s),d=o*Math.sin(a)/h;return[(180*(n+d)/Math.PI+540)%360-180,180*c/Math.PI]}(s,n,r);return a[0]+=a[0]-s[0]>180?-360:s[0]-a[0]>180?360:0,Jr(a,i.properties)}function yi(e,t,r){if(!(i=r=r||{})||i.constructor!==Object)throw new Error("options is invalid");var i,o=r.origin,n=r.mutate;if(!e)throw new Error("geojson required");if("number"!=typeof t||0===t)throw new Error("invalid factor");var s=Array.isArray(o)||"object"==typeof o;return!0!==n&&(e=oi(e)),"FeatureCollection"!==e.type||s?fi(e,t,o):(function(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length&&!1!==t(e.features[r],r);r++);}(e,(function(r,i){e.features[i]=fi(r,t,o)})),e)}function fi(e,t,r){var i,o="Point"===("FeatureCollection"===(i=e).type?"FeatureCollection":"GeometryCollection"===i.type?"GeometryCollection":"Feature"===i.type&&null!==i.geometry?i.geometry.type:i.type);return r=function(e,t){null==t&&(t="centroid");if(Array.isArray(t)||"object"==typeof t)return ci(t);var r=e.bbox?e.bbox:ri(e),i=r[0],o=r[1],n=r[2],s=r[3];switch(t){case"sw":case"southwest":case"westsouth":case"bottomleft":return Jr([i,o]);case"se":case"southeast":case"eastsouth":case"bottomright":return Jr([n,o]);case"nw":case"northwest":case"westnorth":case"topleft":return Jr([i,s]);case"ne":case"northeast":case"eastnorth":case"topright":return Jr([n,s]);case"center":return function(e,t){void 0===t&&(t={});var r=ri(e);return Jr([(r[0]+r[2])/2,(r[1]+r[3])/2],t.properties,t)}(e);case void 0:case null:case"centroid":return function(e,t){void 0===t&&(t={});var r=0,i=0,o=0;return ti(e,(function(e){r+=e[0],i+=e[1],o++}),!0),Jr([r/o,i/o],t.properties)}(e);default:throw new Error("invalid origin")}}(e,r),1===t||o||ti(e,(function(e){var i,o,n,s,a=hi(r,e),l=(i=r,o=e,void 0===n&&(n={}),(s=n.final?ui(ci(o),ci(i)):ui(ci(i),ci(o)))>180?-(360-s):s),c=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(di(r,a*t,l));e[0]=c[0],e[1]=c[1],3===e.length&&(e[2]*=t)})),e}ri.default=ri;const pi={data:[],parser:{type:"json",x:"lng",y:"lat"}},gi={data:[],parser:{type:"json",x:"fromLng",y:"fromLat",x1:"toLng",y1:"toLat"}},vi={enableCircleSpread:!1,enableLineSpread:!1,circleStrokeColor:"#ccc",lineStroke:"#ccc"},mi=Object.assign(Object.assign({},vi),{enableCircleSpread:!0,enableLineSpread:!0}),bi={source:{data:[],parser:{type:"json",x:"f_lon",y:"f_lat",x1:"t_lon",y1:"t_lat",weight:"weight"}},enableCluster:!0,clusterType:"HCA",clusterZoomStep:1,clusterNodeSize:64,clusterRadius:40,clusterExtent:512,maxTopFlowNum:5e3,circleColor:"#fff",circleRadius:{field:"weight",value:[1,16]},circleStrokeColor:"#000",circleStrokeWidth:1,lineColor:{field:"weight",value:["#2a5674","#d1eeea"]},lineWidth:{field:"weight",value:[1,16]},lineStroke:"#000",lineStrokeWidth:1,fadeOpacityEnabled:!0,fadeOpacityAmount:0,showLocationName:!1,locationNameSize:12,locationNameColor:"#fff",locationNameStroke:"#000",locationNameStrokeWidth:1,state:{active:vi,select:mi}};var Li="NOT_FOUND";var Si=function(e,t){return e===t};function Oi(e,t){var r,i,o="object"==typeof t?t:{equalityCheck:t},n=o.equalityCheck,s=void 0===n?Si:n,a=o.maxSize,l=void 0===a?1:a,c=o.resultEqualityCheck,u=function(e){return function(t,r){if(null===t||null===r||t.length!==r.length)return!1;for(var i=t.length,o=0;o<i;o++)if(!e(t[o],r[o]))return!1;return!0}}(s),h=1===l?(r=u,{get:function(e){return i&&r(i.key,e)?i.value:Li},put:function(e,t){i={key:e,value:t}},getEntries:function(){return i?[i]:[]},clear:function(){i=void 0}}):function(e,t){var r=[];function i(e){var i=r.findIndex((function(r){return t(e,r.key)}));if(i>-1){var o=r[i];return i>0&&(r.splice(i,1),r.unshift(o)),o.value}return Li}return{get:i,put:function(t,o){i(t)===Li&&(r.unshift({key:t,value:o}),r.length>e&&r.pop())},getEntries:function(){return r},clear:function(){r=[]}}}(l,u);function d(){var t=h.get(arguments);if(t===Li){if(t=e.apply(null,arguments),c){var r=h.getEntries().find((function(e){return c(e.value,t)}));r&&(t=r.value)}h.put(arguments,t)}return t}return d.clearCache=function(){return h.clear()},d}function wi(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];var n,s=0,a={memoizeOptions:void 0},l=i.pop();if("object"==typeof l&&(a=l,l=i.pop()),"function"!=typeof l)throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof l+"]");var c=a.memoizeOptions,u=void 0===c?r:c,h=Array.isArray(u)?u:[u],d=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"==typeof e}))){var r=t.map((function(e){return"function"==typeof e?"function "+(e.name||"unnamed")+"()":typeof e})).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+r+"]")}return t}(i),y=e.apply(void 0,[function(){return s++,l.apply(null,arguments)}].concat(h)),f=e((function(){for(var e=[],t=d.length,r=0;r<t;r++)e.push(d[r].apply(null,arguments));return n=y.apply(null,e)}));return Object.assign(f,{resultFunc:l,memoizedResultFunc:y,dependencies:d,lastResult:function(){return n},recomputations:function(){return s},resetRecomputations:function(){return s=0}}),f}}var ki=wi(Oi);let xi=0;const Ii=()=>String(++xi);let Ci=0;function Mi(e,...t){return t.reduce(((e,t)=>r=>e(t(r))),e)}function ji(e,t){return t-e?r=>(r-e)/(t-e):e=>.5}const Ai=Math.sqrt(50),_i=Math.sqrt(10),Fi=Math.sqrt(2);function Di(e,t,r){const i=(t-e)/Math.max(0,r),o=Math.floor(Math.log(i)/Math.LN10),n=i/10**o;return o>=0?(n>=Ai?10:n>=_i?5:n>=Fi?2:1)*10**o:-(10**-o)/(n>=Ai?10:n>=_i?5:n>=Fi?2:1)}const zi=(e,t,r=5)=>{const i=[e,t];let o,n=0,s=i.length-1,a=i[n],l=i[s];return l<a&&([a,l]=[l,a],[n,s]=[s,n]),o=Di(a,l,r),o>0?(a=Math.floor(a/o)*o,l=Math.ceil(l/o)*o,o=Di(a,l,r)):o<0&&(a=Math.ceil(a*o)/o,l=Math.floor(l*o)/o,o=Di(a,l,r)),o>0?(i[n]=Math.floor(a/o)*o,i[s]=Math.ceil(l/o)*o):o<0&&(i[n]=Math.ceil(a*o)/o,i[s]=Math.floor(l*o)/o),i};var Ei={}.toString,Pi=function(e,t){return Ei.call(e)==="[object "+t+"]"},Zi=function(e){return Array.isArray?Array.isArray(e):Pi(e,"Array")},Ti=function(e){return"object"==typeof e&&null!==e},Hi=function(e){if(!Ti(e)||!Pi(e,"Object"))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},Ni=function(e){return null===e},Wi=function(e){return void 0===e};function Bi(e,t){if(Object.hasOwn)return Object.hasOwn(e,t);if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)}function $i(e,t,r,i){for(var o in r=r||0,i=i||5,t)if(Bi(t,o)){var n=t[o];null!==n&&Hi(n)?(Hi(e[o])||(e[o]={}),r<i?$i(e[o],n,r+1,i):e[o]=t[o]):Zi(n)?(e[o]=[],e[o]=e[o].concat(n)):void 0!==n&&(e[o]=n)}}var Ri=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var i=0;i<t.length;i+=1)$i(e,t[i]);return e},qi=function(e){return e};function Vi(e){return!Wi(e)&&!Ni(e)&&!Number.isNaN(e)}const Ui=e=>t=>-e(-t),Gi=(e,t)=>{const r=Math.log(e),i=e===Math.E?Math.log:10===e?Math.log10:2===e?Math.log2:e=>Math.log(e)/r;return t?Ui(i):i},Yi=(e,t)=>{const r=e===Math.E?Math.exp:t=>e**t;return t?Ui(r):r},Ki=(e,t,r,i)=>{const o=e<0,n=Gi(i,o),s=Yi(i,o),a=e>t,l=a?t:e,c=a?e:t,u=[s(Math.floor(n(l))),s(Math.ceil(n(c)))];return a?u.reverse():u};var Ji={exports:{}},Qi={exports:{}},Xi=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))},eo=Array.prototype.concat,to=Array.prototype.slice,ro=Qi.exports=function(e){for(var t=[],r=0,i=e.length;r<i;r++){var o=e[r];Xi(o)?t=eo.call(t,to.call(o)):t.push(o)}return t};ro.wrap=function(e){return function(){return e(ro(arguments))}};var io={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},oo=Qi.exports,no=Object.hasOwnProperty,so=Object.create(null);for(var ao in io)no.call(io,ao)&&(so[io[ao]]=ao);var lo=Ji.exports={to:{},get:{}};function co(e,t,r){return Math.min(Math.max(t,e),r)}function uo(e){var t=Math.round(e).toString(16).toUpperCase();return t.length<2?"0"+t:t}lo.get=function(e){var t,r;switch(e.substring(0,3).toLowerCase()){case"hsl":t=lo.get.hsl(e),r="hsl";break;case"hwb":t=lo.get.hwb(e),r="hwb";break;default:t=lo.get.rgb(e),r="rgb"}return t?{model:r,value:t}:null},lo.get.rgb=function(e){if(!e)return null;var t,r,i,o=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=t[2],t=t[1],r=0;r<3;r++){var n=2*r;o[r]=parseInt(t.slice(n,n+2),16)}i&&(o[3]=parseInt(i,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(i=(t=t[1])[3],r=0;r<3;r++)o[r]=parseInt(t[r]+t[r],16);i&&(o[3]=parseInt(i+i,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(r=0;r<3;r++)o[r]=parseInt(t[r+1],0);t[4]&&(t[5]?o[3]=.01*parseFloat(t[4]):o[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(t=e.match(/^(\w+)$/))?"transparent"===t[1]?[0,0,0,0]:no.call(io,t[1])?((o=io[t[1]])[3]=1,o):null:null;for(r=0;r<3;r++)o[r]=Math.round(2.55*parseFloat(t[r+1]));t[4]&&(t[5]?o[3]=.01*parseFloat(t[4]):o[3]=parseFloat(t[4]))}for(r=0;r<3;r++)o[r]=co(o[r],0,255);return o[3]=co(o[3],0,1),o},lo.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var r=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,co(parseFloat(t[2]),0,100),co(parseFloat(t[3]),0,100),co(isNaN(r)?1:r,0,1)]}return null},lo.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var r=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,co(parseFloat(t[2]),0,100),co(parseFloat(t[3]),0,100),co(isNaN(r)?1:r,0,1)]}return null},lo.to.hex=function(){var e=oo(arguments);return"#"+uo(e[0])+uo(e[1])+uo(e[2])+(e[3]<1?uo(Math.round(255*e[3])):"")},lo.to.rgb=function(){var e=oo(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},lo.to.rgb.percent=function(){var e=oo(arguments),t=Math.round(e[0]/255*100),r=Math.round(e[1]/255*100),i=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+r+"%, "+i+"%)":"rgba("+t+"%, "+r+"%, "+i+"%, "+e[3]+")"},lo.to.hsl=function(){var e=oo(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},lo.to.hwb=function(){var e=oo(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},lo.to.keyword=function(e){return so[e.slice(0,3)]};var ho=Ji.exports;function yo(e,t,r){let i=r;return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function fo(e){const t=ho.get(e);if(!t)return null;const{model:r,value:i}=t;return"rgb"===r?i:"hsl"===r?function(e){const t=e[0]/360,r=e[1]/100,i=e[2]/100,o=e[3];if(0===r)return[255*i,255*i,255*i,o];const n=i<.5?i*(1+r):i+r-i*r,s=2*i-n;return[255*yo(s,n,t+1/3),255*yo(s,n,t),255*yo(s,n,t-1/3),o]}(i):null}const po=(e,t)=>r=>e*(1-r)+t*r,go=(e,t)=>"number"==typeof e&&"number"==typeof t?po(e,t):"string"==typeof e&&"string"==typeof t?((e,t)=>{const r=fo(e),i=fo(t);return null===r||null===i?r?()=>e:()=>t:e=>{const t=new Array(4);for(let o=0;o<4;o+=1){const n=r[o],s=i[o];t[o]=n*(1-e)+s*e}const[o,n,s,a]=t;return`rgba(${Math.round(o)}, ${Math.round(n)}, ${Math.round(s)}, ${a})`}})(e,t):()=>e,vo=(e,t)=>{const r=po(e,t);return e=>Math.round(r(e))};class mo{constructor(e){this.options=Ri({},this.getDefaultOptions()),this.update(e)}getOptions(){return this.options}update(e={}){this.options=Ri({},this.options,e),this.rescale(e)}rescale(e){}}const bo=(e,t,r)=>{let i,o,n=e,s=t;if(n===s&&r>0)return[n];let a=Di(n,s,r);if(0===a||!Number.isFinite(a))return[];if(a>0){n=Math.ceil(n/a),s=Math.floor(s/a),o=new Array(i=Math.ceil(s-n+1));for(let e=0;e<i;e+=1)o[e]=(n+e)*a}else{a=-a,n=Math.ceil(n*a),s=Math.floor(s*a),o=new Array(i=Math.ceil(s-n+1));for(let e=0;e<i;e+=1)o[e]=(n+e)/a}return o},Lo=(e,t,r)=>{const[i,o]=e,[n,s]=t;let a,l;return i<o?(a=ji(i,o),l=r(n,s)):(a=ji(o,i),l=r(s,n)),Mi(l,a)},So=(e,t,r)=>{const i=Math.min(e.length,t.length)-1,o=new Array(i),n=new Array(i),s=e[0]>e[i],a=s?[...e].reverse():e,l=s?[...t].reverse():t;for(let e=0;e<i;e+=1)o[e]=ji(a[e],a[e+1]),n[e]=r(l[e],l[e+1]);return t=>{const r=function(e,t,r,i,o){let n=r||0,s=i||e.length;const a=o||(e=>e);for(;n<s;){const r=Math.floor((n+s)/2);a(e[r])>t?s=r:n=r+1}return n}(e,t,1,i)-1,s=o[r];return Mi(n[r],s)(t)}},Oo=(e,t,r,i)=>(Math.min(e.length,t.length)>2?So:Lo)(e,t,i?vo:r);class wo extends mo{getDefaultOptions(){return{domain:[0,1],range:[0,1],nice:!1,clamp:!1,round:!1,interpolate:po,tickCount:5}}map(e){return Vi(e)?this.output(e):this.options.unknown}invert(e){return Vi(e)?this.input(e):this.options.unknown}nice(){if(!this.options.nice)return;const[e,t,r,...i]=this.getTickMethodOptions();this.options.domain=this.chooseNice()(e,t,r,...i)}getTicks(){const{tickMethod:e}=this.options,[t,r,i,...o]=this.getTickMethodOptions();return e(t,r,i,...o)}getTickMethodOptions(){const{domain:e,tickCount:t}=this.options;return[e[0],e[e.length-1],t]}chooseNice(){return zi}rescale(){this.nice();const[e,t]=this.chooseTransforms();this.composeOutput(e,this.chooseClamp(e)),this.composeInput(e,t,this.chooseClamp(t))}chooseClamp(e){const{clamp:t,range:r}=this.options,i=this.options.domain.map(e),o=Math.min(i.length,r.length);return t?function(e,t){const r=t<e?t:e,i=e>t?e:t;return e=>Math.min(Math.max(r,e),i)}(i[0],i[o-1]):qi}composeOutput(e,t){const{domain:r,range:i,round:o,interpolate:n}=this.options,s=Oo(r.map(e),i,n,o);this.output=Mi(s,t,e)}composeInput(e,t,r){const{domain:i,range:o}=this.options,n=Oo(o,i.map(e),po);this.input=Mi(t,r,n)}}const ko=(e,t,r,i=10)=>{const o=e<0,n=Yi(i,o),s=Gi(i,o),a=t<e,l=a?t:e,c=a?e:t;let u=s(l),h=s(c),d=[];if(!(i%1)&&h-u<r){if(u=Math.floor(u),h=Math.ceil(h),o)for(;u<=h;u+=1){const e=n(u);for(let t=i-1;t>=1;t-=1){const r=e*t;if(r>c)break;r>=l&&d.push(r)}}else for(;u<=h;u+=1){const e=n(u);for(let t=1;t<i;t+=1){const r=e*t;if(r>c)break;r>=l&&d.push(r)}}2*d.length<r&&(d=bo(l,c,r))}else{const e=-1===r?h-u:Math.min(h-u,r);d=bo(u,h,e).map(n)}return a?d.reverse():d};class xo extends wo{getDefaultOptions(){return{domain:[1,10],range:[0,1],base:10,interpolate:go,tickMethod:ko,tickCount:5}}chooseNice(){return Ki}getTickMethodOptions(){const{domain:e,tickCount:t,base:r}=this.options;return[e[0],e[e.length-1],t,r]}chooseTransforms(){const{base:e,domain:t}=this.options,r=t[0]<0;return[Gi(e,r),Yi(e,r)]}clone(){return new xo(this.options)}}const Io=t.ScaleTypes.LINEAR;function Co(e,t){var r;if(e instanceof Object&&!(e instanceof Function)&&!Array.isArray(e)){const{field:i,value:o}=e;if("weight"===i&&Array.isArray(o)&&o.length){const i=(null===(r=e.scale)||void 0===r?void 0:r.type)||Io;return Object.assign(Object.assign({},e),{scale:{field:"size",type:i,domain:t}})}}return e}function Mo(e,t){var r;if(e instanceof Object&&!(e instanceof Function)&&!Array.isArray(e)){const{field:i,value:o}=e;if("weight"===i&&Array.isArray(o)&&o.length){const i=(null===(r=e.scale)||void 0===r?void 0:r.type)||Io;return Object.assign(Object.assign({},e),{scale:{field:"color",type:i,domain:t}})}}return e}function jo(e){return 360*(e-.5)}function Ao(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function _o(e){return e/360+.5}function Fo(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Do(e){const t=e.map((e=>e.zoom)).reverse(),r=new Map,i=new Map;function o(r){const i=function(e,t){if(!e.length)throw new Error("No available zoom levels");const r=e.map((e=>Math.abs(e+1-t)));return e[r.indexOf(Math.min(...r))]}(t,r);return e.find((e=>e.zoom===i))}return e.forEach((({locations:e})=>{e.forEach((e=>{r.set(e.id,e)}))})),{zoomList:t,clusterIdMap:r,getAppropriateLevel:o,getMapLocations:function(e,t){const[r,i,n,s]=t,a=o(e),{locations:l,locationTree:c}=a,u=Math.min(_o(r),_o(n)),h=Math.max(_o(r),_o(n)),d=Math.min(Fo(i),Fo(s)),y=Math.max(Fo(i),Fo(s));return c.range(u,d,h,y).map((e=>l[e]))},getLocationIdsFromCluster:function(e){var t;const i=new Set,o=[e];for(;o.length;){const e=o.pop();if(e){const n=r.get(e);n&&((null===(t=n.childIds)||void 0===t?void 0:t.length)?o.push(...n.childIds):i.add(n.id))}}return Array.from(i.values())},findClusterForZoom:function(e,t){const o=`${e}-${t}`;let n=i.get(`${e}-${t}`);if(n)return n;let s=r.get(e);if(s&&s.zoom<=t)return s;let a=(null==s?void 0:s.parentId)&&r.get(s.parentId)||void 0;for(;s&&a&&!(s.zoom>=t&&t>=a.zoom);)s=a,a=(null==s?void 0:s.parentId)&&r.get(s.parentId)||void 0;return n=s&&s.zoom<=t?s:a,n&&i.set(o,n),n}}}function zo(e,t,r,i,o,n){if(o-i<=r)return;const s=i+o>>1;Eo(e,t,s,i,o,n%2),zo(e,t,r,i,s-1,n+1),zo(e,t,r,s+1,o,n+1)}function Eo(e,t,r,i,o,n){for(;o>i;){if(o-i>600){const s=o-i+1,a=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);Eo(e,t,r,Math.max(i,Math.floor(r-a*c/s+u)),Math.min(o,Math.floor(r+(s-a)*c/s+u)),n)}const s=t[2*r+n];let a=i,l=o;for(Po(e,t,i,r),t[2*o+n]>s&&Po(e,t,i,o);a<l;){for(Po(e,t,a,l),a++,l--;t[2*a+n]<s;)a++;for(;t[2*l+n]>s;)l--}t[2*i+n]===s?Po(e,t,i,l):(l++,Po(e,t,l,o)),l<=r&&(i=l+1),r<=l&&(o=l-1)}}function Po(e,t,r,i){Zo(e,r,i),Zo(t,2*r,2*i),Zo(t,2*r+1,2*i+1)}function Zo(e,t,r){const i=e[t];e[t]=e[r],e[r]=i}function To(e,t,r,i){const o=e-r,n=t-i;return o*o+n*n}const Ho=e=>e[0],No=e=>e[1];class Wo{constructor(e,t=Ho,r=No,i=64,o=Float64Array){this.nodeSize=i,this.points=e;const n=e.length<65536?Uint16Array:Uint32Array,s=this.ids=new n(e.length),a=this.coords=new o(2*e.length);for(let i=0;i<e.length;i++)s[i]=i,a[2*i]=t(e[i]),a[2*i+1]=r(e[i]);zo(s,a,i,0,s.length-1,0)}range(e,t,r,i){return function(e,t,r,i,o,n,s){const a=[0,e.length-1,0],l=[];let c,u;for(;a.length;){const h=a.pop(),d=a.pop(),y=a.pop();if(d-y<=s){for(let s=y;s<=d;s++)c=t[2*s],u=t[2*s+1],c>=r&&c<=o&&u>=i&&u<=n&&l.push(e[s]);continue}const f=Math.floor((y+d)/2);c=t[2*f],u=t[2*f+1],c>=r&&c<=o&&u>=i&&u<=n&&l.push(e[f]);const p=(h+1)%2;(0===h?r<=c:i<=u)&&(a.push(y),a.push(f-1),a.push(p)),(0===h?o>=c:n>=u)&&(a.push(f+1),a.push(d),a.push(p))}return l}(this.ids,this.coords,e,t,r,i,this.nodeSize)}within(e,t,r){return function(e,t,r,i,o,n){const s=[0,e.length-1,0],a=[],l=o*o;for(;s.length;){const c=s.pop(),u=s.pop(),h=s.pop();if(u-h<=n){for(let o=h;o<=u;o++)To(t[2*o],t[2*o+1],r,i)<=l&&a.push(e[o]);continue}const d=Math.floor((h+u)/2),y=t[2*d],f=t[2*d+1];To(y,f,r,i)<=l&&a.push(e[d]);const p=(c+1)%2;(0===c?r-o<=y:i-o<=f)&&(s.push(h),s.push(d-1),s.push(p)),(0===c?r+o>=y:i+o>=f)&&(s.push(d+1),s.push(u),s.push(p))}return a}(this.ids,this.coords,e,t,r,this.nodeSize)}}const Bo=e=>e.x,$o=e=>e.y;function Ro(e,t){return new Wo(e,Bo,$o,t,window.Float32Array)}function qo(e,t,r,i,o){return{id:o,lng:jo(e),lat:Ao(t),x:e,y:t,zoom:1/0,weight:i,childIds:r}}function Vo(e,t,r,{clusterRadius:i,clusterExtent:o}){const n=[],s=i/(o*Math.pow(2,t));for(let i=0;i<e.length;i++){const o=e[i];if(o.zoom<=t)continue;o.zoom=t;const a=r.within(o.x,o.y,s);let l=o.weight||1;const c=[o.id];let u=o.x*l,h=o.y*l;const d=Ii();for(const e of a){const i=r.points[e];if(i.zoom<=t)continue;i.zoom=t;const o=i.weight||1;u+=i.x*o,h+=i.y*o,l+=o,c.push(i.id),i.parentId=d}c.length<=1?n.push(o):(o.parentId=d,n.push(qo(u/l,h/l,c,l,d)))}return n}function Uo(e,t){return"HCA"===t.clusterType?function(e,t){var r,i;const{minZoom:o,maxZoom:n,clusterZoomStep:s,clusterNodeSize:a,enableCluster:l}=t,c=[];let u=e.map((e=>Object.assign(Object.assign({},e),{x:_o(e.lng),y:Fo(e.lat),weight:e.weight,zoom:1/0,childIds:[]}))).sort(((e,t)=>e.weight-t.weight));if(c[n+1]=Ro(u,a),l){let e=n+1;for(let r=n;r>=o;r-=s){const i=Vo(u,r,c[e],t);i.length===u.length?(c[r]=c[e],c[e]=void 0,e=r):(e=r,u=i.sort(((e,t)=>e.weight-t.weight)),c[r]=Ro(u,a))}if(0===c.length)return[]}const h=[];for(let e=c.length-1;e>=0;e--){const t=c[e];(null!==(r=null==t?void 0:t.points)&&void 0!==r?r:[]).length&&t&&h.push({locations:Array.from(null!==(i=null==t?void 0:t.points)&&void 0!==i?i:[]).map((t=>(t.zoom=e,t))),locationTree:t,zoom:e})}return h}(e,t):[]}class Go extends x{constructor(){super(...arguments),this.getSourceData=(e,t)=>e.data,this.getSourceParser=(e,t)=>e.parser,this.getMapZoom=(e,t)=>t.mapStatus.zoom,this.getMapBounds=(e,t)=>t.mapStatus.bounds,this.getEnableCluster=(e,t)=>t.enableCluster,this.getClusterType=(e,t)=>t.clusterType,this.getExtent=(e,t)=>t.clusterExtent,this.getNodeSize=(e,t)=>t.clusterNodeSize,this.getRadius=(e,t)=>t.clusterRadius,this.getMinZoom=(e,t)=>t.minZoom,this.getMaxZoom=(e,t)=>t.maxZoom,this.getZoomStep=(e,t)=>t.clusterZoomStep,this.getMaxTopFlowNum=(e,t)=>t.maxTopFlowNum,this.getOriginData=ki(this.getSourceData,this.getSourceParser,((e,t)=>function(e){const t=new Map,r=new Map,{data:i,parser:o}=e,{type:n,x:s,y:a,x1:l,y1:c,weight:u,name:h,name1:d}=o,y=({lng:e,lat:r,weight:i,name:o})=>{const n=`${e}-${r}`;let s=t.get(n);return s||(s={id:Ii(),lng:e,lat:r,weight:i,name:o},t.set(n,s)),s};return"json"===n&&s&&a&&l&&c?i.forEach((e=>{const t=+b(e,s,0),i=+b(e,a,0),o=+b(e,l,0),n=+b(e,c,0),f=u?+b(e,u,0):1,p=`${t}-${i}-${o}-${n}`,g=r.get(p);if(g)g.weight+=f;else{const s=h&&b(e,h,void 0),a=d&&b(e,d,void 0),l=y({lng:t,lat:i,weight:f,name:s}),c=y({lng:o,lat:n,weight:f,name:a});r.set(p,{id:String(++Ci),fromId:l.id,toId:c.id,weight:f})}})):console.error("FlowLayer 的 source 输入有误，请检查 source 传参"),{locations:Array.from(t.values()),flows:Array.from(r.values())}}({data:e,parser:t}))),this.getClusterOptions=ki(this.getClusterType,this.getEnableCluster,this.getExtent,this.getNodeSize,this.getRadius,this.getMinZoom,this.getMaxZoom,this.getZoomStep,(function(e,t,r,i,o,n,s,a){return{clusterType:e,enableCluster:t,clusterExtent:r,clusterNodeSize:i,clusterRadius:o,minZoom:n,maxZoom:s,clusterZoomStep:a}})),this.getClusterLevels=ki(this.getOriginData,this.getClusterOptions,(({locations:e},t)=>Uo(e,t))),this.getClusterIndex=ki(this.getClusterLevels,(e=>Do(e))),this.getViewLocations=ki(this.getClusterIndex,this.getMapZoom,this.getMapBounds,((e,t,r)=>e.getMapLocations(t,r))),this.getLocationWeightRange=ki(this.getClusterIndex,this.getMapZoom,(function(e,t){const{locations:r}=e.getAppropriateLevel(t);if(!r.length)return[0,0];const{weight:i}=r[0],{weight:o}=r[r.length-1];return[i,o]})),this.getAggregatedFlows=ki(this.getClusterIndex,this.getOriginData,this.getMapZoom,((e,{flows:t},r)=>function(e,t,r){const i=new Map,{zoom:o}=t.getAppropriateLevel(r);return e.forEach((({fromId:e,toId:r,weight:n})=>{const s=t.findClusterForZoom(e,o),a=t.findClusterForZoom(r,o);if(!s||!a||s.id===a.id)return;const l=`${s.id}-${a.id}`;let c=i.get(l);c||(c={id:l,fromId:s.id,fromLng:s.lng,fromLat:s.lat,toId:a.id,toLng:a.lng,toLat:a.lat,weight:0},i.set(l,c)),c.weight+=n})),Array.from(i.values()).sort(((e,t)=>e.weight-t.weight))}(t,e,r))),this.getFilterFlows=ki(this.getViewLocations,this.getAggregatedFlows,this.getMaxTopFlowNum,((e,t,r)=>{if(t.length<=r)return t;let i=[...t];const o=new Set(e.map((e=>e.id)));return i=i.filter((e=>o.has(e.fromId)||o.has(e.toId))),i.length>r&&(i=i.slice(i.length-r,i.length)),i})),this.getFilterLocations=ki(this.getViewLocations,this.getFilterFlows,((e,t)=>{const r=new Set(t.map((e=>[e.fromId,e.toId])).flat());return e.filter((e=>r.has(e.id)))})),this.getFlowWeightRange=ki(this.getAggregatedFlows,(function(e){if(!e.length)return[0,0];const{weight:t}=e[0],{weight:r}=e[e.length-1];return[t,r]})),this.getFilterFlowWeightRange=ki(this.getFilterFlows,(function(e){if(!e.length)return[0,0];const{weight:t}=e[0],{weight:r}=e[e.length-1];return[t,r]}))}}class Yo extends R{constructor(e){super(e),this.type=R.LayerType.FlowLayer,this.dataProvider=new Go,this.matchZoom=0,this.onMapChange=Vr((()=>{this.updateSubLayers()}),400,{maxWait:400}),this.onCircleMouseMove=e=>{this.renderHighlightLayers(this._getCircleLayerActiveData(e,this._getFullActiveOptions()))},this.onCircleMouseOut=()=>{this.clearHighlightLayers()},this.onLineMouseMove=e=>{this.renderHighlightLayers(this._getLineLayerActiveData(e,this._getFullActiveOptions()))},this.onLineMouseOut=()=>{this.clearHighlightLayers()},this.onCircleClick=e=>{var t,r,i;e.feature.id!==(null===(i=null===(r=null===(t=this.circleSelectLayer)||void 0===t?void 0:t.options.source.data)||void 0===r?void 0:r[0])||void 0===i?void 0:i.id)?this.renderSelectLayers(this._getCircleLayerActiveData(e,this._getFullSelectOptions())):this.clearSelectLayers()},this.onLineClick=e=>{var t,r,i;e.feature.id!==(null===(i=null===(r=null===(t=this.lineSelectLayer)||void 0===t?void 0:t.options.source.data)||void 0===r?void 0:r[0])||void 0===i?void 0:i.id)?this.renderSelectLayers(this._getLineLayerActiveData(e,this._getFullSelectOptions())):this.clearSelectLayers()},this.initSubLayersEvent()}get layer(){return this.lineLayer}get circleLayer(){var e;return null===(e=this.subLayers)||void 0===e?void 0:e.getLayer("circleLayer")}get lineLayer(){var e;return null===(e=this.subLayers)||void 0===e?void 0:e.getLayer("lineLayer")}get locationNameLayer(){var e;return null===(e=this.subLayers)||void 0===e?void 0:e.getLayer("locationNameLayer")}get circleHighlightLayer(){var e;return null===(e=this.subLayers)||void 0===e?void 0:e.getLayer("circleHighlightLayer")}get circleSelectLayer(){var e;return null===(e=this.subLayers)||void 0===e?void 0:e.getLayer("circleSelectLayer")}get lineHighlightLayer(){var e;return null===(e=this.subLayers)||void 0===e?void 0:e.getLayer("lineHighlightLayer")}get lineSelectLayer(){var e;return null===(e=this.subLayers)||void 0===e?void 0:e.getLayer("lineSelectLayer")}getDefaultOptions(){return Yo.DefaultOptions}createSubLayers(){const e=new H({id:"circleLayer",name:"circleLayer",source:pi}),t=new W({id:"lineLayer",name:"lineLayer",source:gi}),r=new N({id:"locationNameLayer",name:"locationNameLayer",source:pi}),i=new H({id:"circleHighlightLayer",name:"circleHighlightLayer",source:pi}),o=new H({id:"circleSelectLayer",name:"circleSelectLayer",source:pi}),n=new W({id:"lineHighlightLayer",name:"lineHighlightLayer",source:gi}),s=new W({id:"lineSelectLayer",name:"lineSelectLayer",source:gi});return I.forEach((r=>{e.on(r,(e=>this.emit(`circleLayer:${r}`,e))),t.on(r,(e=>this.emit(`lineLayer:${r}`,e)))})),[t,e,r,i,o,n,s]}update(e){super.update(e),this.initSubLayersEvent(),e.source!==this.options.source&&this.clearActiveLayers()}addTo(e){var t,r;this.scene=e,this.updateSubLayers(),super.addTo(e),null===(t=this.scene)||void 0===t||t.on("zoomchange",this.onMapChange),null===(r=this.scene)||void 0===r||r.on("mapmove",this.onMapChange)}remove(){var e,t;super.remove(),null===(e=this.scene)||void 0===e||e.off("zoomchange",this.onMapChange),null===(t=this.scene)||void 0===t||t.off("mapmove",this.onMapChange)}updateSubLayers(){var e;this.updateClusterState(),null===(e=this.circleLayer)||void 0===e||e.update(this.getCircleLayerOptions()),this.getLocationNameLayerOptions().then((e=>{var t;null===(t=this.locationNameLayer)||void 0===t||t.update(e)})),requestAnimationFrame((()=>{var e,t,r,i,o,n,s;null===(e=this.lineLayer)||void 0===e||e.update(this.getLineLayerOptions()),null===(t=this.circleHighlightLayer)||void 0===t||t.update(this.getCircleHighlightLayerOptions()),null===(r=this.circleSelectLayer)||void 0===r||r.update(this.getCircleSelectLayerOptions()),null===(i=this.lineHighlightLayer)||void 0===i||i.update(this.getLineHighlightLayerOptions()),null===(o=this.lineSelectLayer)||void 0===o||o.update(this.getLineSelectLayerOptions());const{getAppropriateLevel:a}=this.dataProvider.getClusterIndex(this.options.source,this.dataProviderState),l=null!==(s=null===(n=a(this.dataProviderState.mapStatus.zoom))||void 0===n?void 0:n.zoom)&&void 0!==s?s:0;l!==this.matchZoom&&(this.clearActiveLayers(),this.matchZoom=l)}))}initSubLayersEvent(){var e,t,r,i,o,n,s,a,l,c,u,h,d,y;null===(e=this.circleLayer)||void 0===e||e.off("mousemove",this.onCircleMouseMove),null===(t=this.circleLayer)||void 0===t||t.off("mouseout",this.onCircleMouseOut),null===(r=this.circleLayer)||void 0===r||r.off("click",this.onCircleClick),null===(i=this.lineLayer)||void 0===i||i.off("mousemove",this.onLineMouseMove),null===(o=this.lineLayer)||void 0===o||o.off("mouseout",this.onLineMouseOut),null===(n=this.lineLayer)||void 0===n||n.off("click",this.onLineClick),(null===(s=this.options.state)||void 0===s?void 0:s.active)&&(null===(a=this.circleLayer)||void 0===a||a.on("mousemove",this.onCircleMouseMove),null===(l=this.circleLayer)||void 0===l||l.on("mouseout",this.onCircleMouseOut),null===(c=this.lineLayer)||void 0===c||c.on("mousemove",this.onLineMouseMove),null===(u=this.lineLayer)||void 0===u||u.on("mouseout",this.onLineMouseOut)),(null===(h=this.options.state)||void 0===h?void 0:h.select)&&(null===(d=this.circleLayer)||void 0===d||d.on("click",this.onCircleClick),null===(y=this.lineLayer)||void 0===y||y.on("click",this.onLineClick))}updateClusterState(){const e=this.scene;if(!e)return;const t=e.getMaxZoom(),r=e.getMinZoom(),i=yi(ii(e.getBounds().flat()),1.1);this.dataProviderState=Object.assign(Object.assign({},this.options),{mapStatus:{zoom:e.getZoom(),bounds:ri(i)},maxZoom:t,minZoom:r})}getCircleLayerOptions(){const{minZoom:e,maxZoom:t,zIndex:r,visible:i,blend:o,pickingBuffer:n,circleStrokeColor:s,circleStrokeWidth:a,circleOpacity:l}=this.options,c={source:{data:[],parser:{type:"json",x:"lng",y:"lat"}},shape:"circle",minZoom:e,maxZoom:t,zIndex:r,visible:i,blend:o,pickingBuffer:n,style:{stroke:s,strokeWidth:a,opacity:l}};if(this.dataProvider&&this.scene){const e=this.dataProvider.getLocationWeightRange(this.options.source,this.dataProviderState);c.source.data=this.dataProvider.getFilterLocations(this.options.source,this.dataProviderState),c.size=Co(this.options.circleRadius,e),c.color=Mo(this.options.circleColor,e)}return c}getLineLayerOptions(){const{minZoom:e,maxZoom:t,zIndex:r,visible:i,blend:o,pickingBuffer:n,lineOpacity:s,lineWidth:a,lineColor:l,lineStroke:c,lineStrokeOpacity:u,lineStrokeWidth:h}=this.options,d={source:{data:[],parser:{type:"json",x:"fromLng",y:"fromLat",x1:"toLng",y1:"toLat"}},shape:"flowline",minZoom:e,maxZoom:t,zIndex:r,visible:i,blend:o,pickingBuffer:n,style:{gapWidth:h,stroke:c,strokeWidth:h,strokeOpacity:u,opacity:s}};if(this.dataProvider&&this.scene){const e=this.dataProvider.getFlowWeightRange(this.options.source,this.dataProviderState),t=this.dataProvider.getFilterFlowWeightRange(this.options.source,this.dataProviderState);if(d.source.data=this.dataProvider.getFilterFlows(this.options.source,this.dataProviderState),d.size=Co(a,e),d.color=Mo(l,e),this.options.fadeOpacityEnabled&&d.style&&(d.style.opacity=function(e,t){const r=new xo({domain:e,range:[0,1]}),i=1.5*(1-t/100);return{field:"weight",value:e=>r.map(e)*i}}(t,this.options.fadeOpacityAmount)),this.circleLayer&&d.style){const e=this.dataProvider.getClusterIndex(this.options.source,this.dataProviderState);d.style.offsets=function(e,t){var r;const i=t.options.size;if("number"==typeof i)return[i,i];{const i=null===(r=null==t?void 0:t.layer)||void 0===r?void 0:r.getScale("size");return{field:"fromId*toId",value:(t,r)=>{var o,n;const s=e.clusterIdMap.get(t),a=e.clusterIdMap.get(r);return[null!==(o=s?null==i?void 0:i(s.weight):0)&&void 0!==o?o:0,null!==(n=a?null==i?void 0:i(a.weight):0)&&void 0!==n?n:0]}}}}(e,this.circleLayer)}}return d}getLocationNameLayerOptions(){return k(this,void 0,void 0,(function*(){var e,t;const{minZoom:r,maxZoom:i,zIndex:o,visible:n,blend:s,pickingBuffer:a,showLocationName:l,getClusterLocationName:c,locationNameColor:u,locationNameSize:h,locationNameStroke:d,locationNameStrokeWidth:y,locationNameStrokeOpacity:f,locationNameOffset:p}=this.options,g=Object.assign({},l&&null!==(t=null===(e=this.circleLayer)||void 0===e?void 0:e.options.source)&&void 0!==t?t:pi);c&&(g.data=yield Promise.all(g.data.map(((e,t)=>k(this,void 0,void 0,(function*(){if(!e.name)try{e.name=yield c(e,t)}catch(t){e.name=""}return e}))))));return{source:g,field:"name",minZoom:r,maxZoom:i,zIndex:o,visible:n,blend:s,pickingBuffer:a,style:{fill:u,fontSize:h,stroke:d,strokeOpacity:f,strokeWidth:y,textOffset:p}}}))}getCircleHighlightLayerOptions(){return this._getCircleActiveLayerOptions(this._getFullActiveOptions())}getCircleSelectLayerOptions(){return this._getCircleActiveLayerOptions(this._getFullSelectOptions())}getLineHighlightLayerOptions(){return this._getLineActiveLayerOptions(this._getFullActiveOptions())}getLineSelectLayerOptions(){return this._getLineActiveLayerOptions(this._getFullSelectOptions())}renderHighlightLayers({locations:e,flows:t}){var r,i;null===(r=this.circleHighlightLayer)||void 0===r||r.update({source:{data:e,parser:{type:"json",x:"lng",y:"lat"}}}),null===(i=this.lineHighlightLayer)||void 0===i||i.update({source:{data:t,parser:{type:"json",x:"fromLng",y:"fromLat",x1:"toLng",y1:"toLat"}}})}renderSelectLayers({locations:e,flows:t}){var r,i;null===(r=this.circleSelectLayer)||void 0===r||r.update({source:{data:e,parser:{type:"json",x:"lng",y:"lat"}}}),null===(i=this.lineSelectLayer)||void 0===i||i.update({source:{data:t,parser:{type:"json",x:"fromLng",y:"fromLat",x1:"toLng",y1:"toLat"}}})}clearActiveLayers(){this.clearHighlightLayers(),this.clearSelectLayers()}clearHighlightLayers(){this.renderHighlightLayers({locations:[],flows:[]})}clearSelectLayers(){this.renderSelectLayers({locations:[],flows:[]})}_getCircleLayerActiveData(e,{enableCircleSpread:t}){const r=e.feature,{id:i}=r;let o=[];if(t){o=this.dataProvider.getFilterFlows(this.options.source,this.dataProviderState).filter((e=>e.fromId===i||e.toId===i))}return{locations:[r],flows:o}}_getLineLayerActiveData(e,{enableLineSpread:t}){const r=e.feature,i=[],{fromId:o,toId:n}=r;if(t){const{clusterIdMap:e}=this.dataProvider.getClusterIndex(this.options.source,this.dataProviderState),t=e.get(o),r=e.get(n);t&&i.push(t),r&&i.push(r)}return{locations:i,flows:[r]}}_getFullActiveOptions(){var e,t;return Object.assign(Object.assign({},vi),(null===(e=this.options.state)||void 0===e?void 0:e.active)instanceof Object?null===(t=this.options.state)||void 0===t?void 0:t.active:{})}_getFullSelectOptions(){var e,t;return Object.assign(Object.assign({},mi),(null===(e=this.options.state)||void 0===e?void 0:e.select)instanceof Object?null===(t=this.options.state)||void 0===t?void 0:t.select:{})}_getCircleActiveLayerOptions({circleColor:e,circleStrokeColor:t}){var r,i;const{color:o,size:n,shape:s,style:a}=null!==(i=null===(r=this.circleLayer)||void 0===r?void 0:r.options)&&void 0!==i?i:{};return{color:null!=e?e:o,shape:s,size:n,style:{stroke:t,strokeWidth:a.strokeWidth}}}_getLineActiveLayerOptions({lineColor:e,lineStroke:t}){var r,i;const{color:o,size:n,shape:s,style:a}=null!==(i=null===(r=this.lineLayer)||void 0===r?void 0:r.options)&&void 0!==i?i:{};return{color:null!=e?e:o,size:n,shape:s,style:{stroke:t,strokeWidth:a.lineStrokeWidth,gapWidth:a.lineStrokeWidth,offsets:a.offsets}}}}Yo.DefaultOptions=bi,Object.defineProperty(e,"BlendType",{enumerable:!0,get:function(){return t.BlendType}}),e.BubbleLayer=X,e.ChoroplethLayer=se,e.FlowLayer=Yo,e.HeatmapLayer=class extends T{constructor(){super(...arguments),this.type="heatmapLayer"}createLayer(){const e=this.getLayerConfig();return new t.HeatmapLayer(e)}},e.IconFontLayer=he,e.IconImageLayer=Ur,e.ImageLayer=class extends T{constructor(){super(...arguments),this.type="imageLayer"}createLayer(){const e=this.getLayerConfig();return new t.ImageLayer(e)}},e.LayerGroup=_,e.LineLayer=W,e.PointLayer=H,e.PolygonLayer=$,e.RasterLayer=class extends T{constructor(){super(...arguments),this.type="rasterLayer"}createLayer(){const e=this.getLayerConfig();return new t.RasterLayer(e)}},e.TextLayer=N,e.version="0.17.1",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=l7-composite-layers.min.js.map
